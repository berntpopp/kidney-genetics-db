---
phase: "05"
plan: "05-03"
title: "Evidence components + GeneDetail + GeneStructure"
wave: 3
depends_on: ["05-02"]
files_modified:
  - "frontend/src/components/evidence/EvidenceCard.vue"
  - "frontend/src/components/evidence/ClinGenEvidence.vue"
  - "frontend/src/components/evidence/GenCCEvidence.vue"
  - "frontend/src/components/evidence/HPOEvidence.vue"
  - "frontend/src/components/evidence/PubTatorEvidence.vue"
  - "frontend/src/components/evidence/PanelAppEvidence.vue"
  - "frontend/src/components/evidence/DiagnosticPanelsEvidence.vue"
  - "frontend/src/components/evidence/LiteratureEvidence.vue"
  - "frontend/src/views/GeneDetail.vue"
  - "frontend/src/views/GeneStructure.vue"
autonomous: true
estimated_minutes: 90
requirements:
  - "EVID-04: EvidenceCard uses Accordion instead of v-expansion-panel"
  - "EVID-05: All evidence source components use Badge + Tooltip"
  - "EVID-06: GeneDetail uses Tabs + DropdownMenu + Breadcrumb"
  - "EVID-07: GeneStructure uses Card + Alert"

must_haves:
  truths:
    - "All 10 files have zero Vuetify component tags"
    - "`npm run build` succeeds"
    - "`npm run lint` has 0 errors"
    - "Evidence accordion expands/collapses correctly"
    - "GeneDetail page tabs work (Overview, Evidence, Structure)"
    - "Evidence filtering by source works"
    - "All evidence type components render their data correctly"
  artifacts:
    - path: "frontend/src/components/evidence/EvidenceCard.vue"
      provides: "Accordion-based evidence display with dynamic source components"
    - path: "frontend/src/views/GeneDetail.vue"
      provides: "Gene detail page with Tabs + Breadcrumb + evidence list"
    - path: "frontend/src/views/GeneStructure.vue"
      provides: "Gene structure page with Card + Alert"

---

# 05-03: Evidence Components + Gene Detail Pages

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Migrate the evidence card/source components and the two gene detail pages.

**Architecture:** Evidence source components follow a uniform pattern (Badge + Tooltip). EvidenceCard wraps them in Accordion. GeneDetail orchestrates everything with Tabs.

---

## Key Component Mappings

| Vuetify | shadcn-vue |
|---------|-----------|
| `v-expansion-panels` + `v-expansion-panel` | Accordion + AccordionItem |
| `v-expansion-panel-title` | AccordionTrigger |
| `v-expansion-panel-text` | AccordionContent |
| `v-chip-group` | `<div class="flex flex-wrap gap-1">` |
| `v-list` + `v-list-item` (density="compact") | `<div class="space-y-1">` + styled items |
| `v-expand-transition` | CSS transition or `<Collapsible>` |
| `v-tabs` + `v-tab` | Tabs + TabsList + TabsTrigger |
| `v-tabs-window` + `v-tabs-window-item` | TabsContent |
| `v-select` | Custom Popover or native select |

---

<task id="1">
### Task 1: Install shadcn-vue accordion (if not already)

Check if accordion exists:
```bash
ls frontend/src/components/ui/accordion/ 2>/dev/null || echo "NOT INSTALLED"
```

If not installed:
```bash
cd frontend && npx shadcn-vue@latest add accordion
```

Also install collapsible for expand transitions:
```bash
cd frontend && npx shadcn-vue@latest add collapsible
```

**Commit:**
```bash
git add frontend/src/components/ui/accordion/ frontend/src/components/ui/collapsible/
git commit -m "feat(05-03): install shadcn-vue accordion and collapsible"
```
</task>

<task id="2" depends_on="1">
### Task 2: Migrate EvidenceCard.vue

**Files:** Modify `frontend/src/components/evidence/EvidenceCard.vue`

**Key replacements:**
- `v-expansion-panel` / `v-expansion-panel-title` / `v-expansion-panel-text` → Accordion components
- `v-avatar` → Avatar
- `v-chip` → Badge
- `v-btn` → Button

**Note:** EvidenceCard is used inside `v-expansion-panels` in GeneDetail.vue. Since we'll migrate GeneDetail later in this plan, we need EvidenceCard to work both standalone and within a parent Accordion. The simplest approach: make EvidenceCard an AccordionItem that expects to be wrapped in an Accordion by its parent.

**Template pattern:**
```vue
<template>
  <AccordionItem :value="evidence.source_name" class="border rounded-lg mb-2">
    <AccordionTrigger class="px-4 py-3 hover:no-underline">
      <div class="flex items-center justify-between w-full mr-4">
        <!-- Left: source icon + name -->
        <div class="flex items-center gap-3">
          <Avatar class="h-8 w-8" :style="{ backgroundColor: sourceColor + '20' }">
            <AvatarFallback>
              <component :is="sourceIcon" :size="16" :style="{ color: sourceColor }" />
            </AvatarFallback>
          </Avatar>
          <div>
            <span class="text-sm font-medium">{{ evidence.source_display_name }}</span>
            <span class="text-xs text-muted-foreground ml-2">{{ summaryText }}</span>
          </div>
        </div>
        <!-- Right: score badge + count -->
        <div class="flex items-center gap-2">
          <Badge
            variant="outline"
            :style="{ backgroundColor: getScoreColor(evidence.score) + '20', color: getScoreColor(evidence.score) }"
          >
            {{ evidence.score?.toFixed(1) ?? '—' }}
          </Badge>
          <Badge variant="secondary" class="text-xs">
            {{ primaryCount }}
          </Badge>
        </div>
      </div>
    </AccordionTrigger>
    <AccordionContent class="px-4 pb-4">
      <!-- Dynamic evidence component based on source -->
      <component :is="evidenceComponent" :evidence-data="evidence.data" :source-name="evidence.source_name" />
      <!-- Footer: last updated -->
      <div class="border-t pt-3 mt-4 flex items-center justify-between text-xs text-muted-foreground">
        <span>Last updated: {{ formatDate(evidence.updated_at) }}</span>
        <Button v-if="evidence.source_url" variant="ghost" size="sm" as="a" :href="evidence.source_url" target="_blank">
          View source
        </Button>
      </div>
    </AccordionContent>
  </AccordionItem>
</template>
```

**Imports:**
```typescript
import { AccordionItem, AccordionTrigger, AccordionContent } from '@/components/ui/accordion'
import { Avatar, AvatarFallback } from '@/components/ui/avatar'
import { Badge } from '@/components/ui/badge'
import { Button } from '@/components/ui/button'
```

**Preserve all computed logic** (sourceColor, sourceIcon, summaryText, primaryCount, evidenceComponent, getScoreColor, formatDate).

**Commit:**
```bash
git add frontend/src/components/evidence/EvidenceCard.vue
git commit -m "feat(05-03): migrate EvidenceCard to AccordionItem + Badge"
```
</task>

<task id="3" depends_on="1">
### Task 3: Migrate evidence source components (ClinGen, GenCC, HPO, PubTator)

**Files:**
- `frontend/src/components/evidence/ClinGenEvidence.vue`
- `frontend/src/components/evidence/GenCCEvidence.vue`
- `frontend/src/components/evidence/HPOEvidence.vue`
- `frontend/src/components/evidence/PubTatorEvidence.vue`

**Universal pattern for all evidence components:**

1. Replace `v-chip` → Badge (with inline style colors)
2. Replace `v-list`/`v-list-item` → `<div class="space-y-2">` + styled items
3. Replace `v-btn` (Show More) → Button
4. Replace `v-expansion-panels` (nested) → Accordion
5. Replace `v-row`/`v-col` → Tailwind grid
6. Replace `v-expand-transition` → Collapsible (or simple v-show)
7. Replace `bg-surface-light` → `bg-muted`
8. Replace all Vuetify utility classes with Tailwind

**ClinGenEvidence specific:**
- Classification badges with dynamic colors → Badge with inline styles
- Validity list items → `<div>` with flex layout
- Show/hide toggle for additional validities → Button + v-show

**GenCCEvidence specific:**
- Nested expansion panels for submissions → Accordion within AccordionContent
- Classification chips → Badge
- Submitter x-small chips → Badge variant="secondary" class="text-[10px]"

**HPOEvidence specific:**
- `v-chip-group` → `<div class="flex flex-wrap gap-1">`
- Phenotype term chips → Badge with link to HPO website
- Scrollable container (`max-height: 400px`) → ScrollArea or `<div class="max-h-[400px] overflow-y-auto">`

**PubTatorEvidence specific:**
- Publication list items → styled divs
- PMID chips → Badge as link (`as="a"`)
- Statistics section → Tailwind grid

**Commit after all 4:**
```bash
git add frontend/src/components/evidence/ClinGenEvidence.vue \
  frontend/src/components/evidence/GenCCEvidence.vue \
  frontend/src/components/evidence/HPOEvidence.vue \
  frontend/src/components/evidence/PubTatorEvidence.vue
git commit -m "feat(05-03): migrate ClinGen, GenCC, HPO, PubTator evidence to Badge + Tooltip"
```
</task>

<task id="4" depends_on="1">
### Task 4: Migrate evidence source components (PanelApp, DiagnosticPanels, Literature)

**Files:**
- `frontend/src/components/evidence/PanelAppEvidence.vue`
- `frontend/src/components/evidence/DiagnosticPanelsEvidence.vue`
- `frontend/src/components/evidence/LiteratureEvidence.vue`

**Same patterns as Task 3.** Additional specifics:

**PanelAppEvidence:**
- `v-avatar` for region codes → Avatar with AvatarFallback
- Panel list items with external links → styled divs with Button links
- Region color mapping → keep functions, use Badge inline styles
- Statistics row/col → Tailwind grid

**DiagnosticPanelsEvidence:**
- Nested `v-expansion-panels` for providers → Accordion
- Panel chips → Badge
- Gene metadata display → styled divs

**LiteratureEvidence:**
- Publication list with numbered `v-avatar` → Avatar with numbered fallback
- PMID/DOI `v-chip` links → Badge as links
- Author formatting → keep existing functions
- Scrollable container → `<div class="max-h-[200px] overflow-y-auto">`

**Commit:**
```bash
git add frontend/src/components/evidence/PanelAppEvidence.vue \
  frontend/src/components/evidence/DiagnosticPanelsEvidence.vue \
  frontend/src/components/evidence/LiteratureEvidence.vue
git commit -m "feat(05-03): migrate PanelApp, DiagnosticPanels, Literature evidence to Badge + Tooltip"
```
</task>

<task id="5" depends_on="2,3,4">
### Task 5: Migrate GeneDetail.vue

**Files:** Modify `frontend/src/views/GeneDetail.vue`

**Key replacements:**
- `v-container` → `<div class="container mx-auto px-4">`
- `v-breadcrumbs` → Breadcrumb
- `v-btn` → Button
- `v-menu` (gene actions) → DropdownMenu
- `v-select` (evidence filter) → Popover multi-select (same pattern as Dashboard tier filter from 04-02)
- `v-expansion-panels` (evidence list wrapper) → Accordion
- `v-row`/`v-col` → Tailwind grid
- `v-progress-circular` → Tailwind spinner
- `v-expand-transition` → Collapsible or v-show

**Imports:**
```typescript
import { Breadcrumb, BreadcrumbItem, BreadcrumbLink, BreadcrumbList, BreadcrumbPage, BreadcrumbSeparator } from '@/components/ui/breadcrumb'
import { Button } from '@/components/ui/button'
import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from '@/components/ui/dropdown-menu'
import { Accordion } from '@/components/ui/accordion'
import { Badge } from '@/components/ui/badge'
import { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover'
```

**Evidence list wrapper:**
```vue
<!-- Wrap all EvidenceCards in a single Accordion -->
<Accordion type="multiple" class="space-y-2">
  <EvidenceCard
    v-for="evidence in filteredEvidence"
    :key="evidence.source_name"
    :evidence="evidence"
  />
</Accordion>
```

**Gene actions dropdown (for curators/admins):**
```vue
<DropdownMenu>
  <DropdownMenuTrigger as-child>
    <Button variant="outline" size="sm">
      Actions <ChevronDown :size="14" class="ml-1" />
    </Button>
  </DropdownMenuTrigger>
  <DropdownMenuContent>
    <DropdownMenuItem @click="copyGeneId">Copy Gene ID</DropdownMenuItem>
    <DropdownMenuItem @click="viewInHGNC">View in HGNC</DropdownMenuItem>
    <DropdownMenuItem v-if="canEdit" @click="editGene">Edit Gene</DropdownMenuItem>
  </DropdownMenuContent>
</DropdownMenu>
```

**Evidence source filter:** Use same Popover + checkbox pattern from Dashboard (04-02).

**Commit:**
```bash
git add frontend/src/views/GeneDetail.vue
git commit -m "feat(05-03): migrate GeneDetail to Accordion + DropdownMenu + Breadcrumb"
```
</task>

<task id="6" depends_on="5">
### Task 6: Migrate GeneStructure.vue

**Files:** Modify `frontend/src/views/GeneStructure.vue`

**Key replacements:**
- `v-container` → Tailwind container
- `v-breadcrumbs` → Breadcrumb
- `v-btn` → Button
- `v-card`/`v-card-title`/`v-card-subtitle`/`v-card-text` → Card + sub-components
- `v-alert` → Alert
- `v-list`/`v-list-item` → styled divs
- `v-row`/`v-col` → Tailwind grid
- `v-progress-circular` → Tailwind spinner

**Keep visualization component embeds unchanged** (GeneStructureVisualization, ProteinDomainVisualization — migrated in Phase 08).

**Gene info section pattern:**
```vue
<Card>
  <CardHeader>
    <CardTitle class="text-lg">Gene Information</CardTitle>
  </CardHeader>
  <CardContent>
    <div class="space-y-3">
      <div class="flex items-center gap-2">
        <Hash :size="16" class="text-muted-foreground" />
        <span class="text-sm font-medium">Ensembl ID:</span>
        <span class="text-sm font-mono">{{ ensemblId }}</span>
      </div>
      <!-- ... more info rows ... -->
    </div>
  </CardContent>
</Card>
```

**External link buttons:**
```vue
<div class="flex flex-wrap gap-2 mt-4">
  <Button v-if="ensemblId" variant="outline" size="sm" as="a" :href="ensemblUrl" target="_blank">
    <ExternalLink :size="14" class="mr-1" />
    Ensembl
  </Button>
  <!-- ... more external links ... -->
</div>
```

**Commit:**
```bash
git add frontend/src/views/GeneStructure.vue
git commit -m "feat(05-03): migrate GeneStructure to Card + Alert + Breadcrumb"
```
</task>

<task id="7" depends_on="5,6">
### Task 7: Phase 05 Verification

**Build + lint:**
```bash
cd frontend && npm run build && npm run lint
```

**Vuetify audit on ALL Phase 05 files:**
```bash
grep -rE "v-expansion-panel|v-chip|v-tooltip|v-card|v-avatar|v-btn|v-alert|v-list|v-select|v-menu|v-container|v-row|v-col|v-breadcrumbs|v-divider|v-progress-circular|v-tabs|v-tab|v-expand-transition|v-chip-group" \
  frontend/src/components/evidence/ \
  frontend/src/components/gene/ \
  frontend/src/components/EvidenceTierBadge.vue \
  frontend/src/components/TierHelpDialog.vue \
  frontend/src/components/ScoreBreakdown.vue \
  frontend/src/views/GeneDetail.vue \
  frontend/src/views/GeneStructure.vue \
  --include="*.vue"
```
Expected: 0 matches.

**Visual verification:**
- `/genes/BRCA1` (or any gene) — gene detail page loads
- Evidence accordion items expand/collapse
- Evidence filter shows/hides sources
- Each evidence type renders correctly (ClinGen, GenCC, HPO, PubTator, PanelApp, DiagPanels, Literature)
- Tier badges show in evidence headers
- Score breakdown displays correctly
- Gene structure page renders info + visualization placeholders
- All tooltips work on hover
</task>
