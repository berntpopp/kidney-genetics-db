---
phase: "05"
plan: "05-01"
title: "Shared components: EvidenceTierBadge, TierHelpDialog, ScoreBreakdown"
wave: 1
depends_on: ["04-02"]
files_modified:
  - "frontend/src/components/EvidenceTierBadge.vue"
  - "frontend/src/components/TierHelpDialog.vue"
  - "frontend/src/components/ScoreBreakdown.vue"
autonomous: true
estimated_minutes: 40
requirements:
  - "EVID-01: EvidenceTierBadge uses Tooltip + Badge"
  - "EVID-02: TierHelpDialog uses Dialog + Card"
  - "EVID-03: ScoreBreakdown uses Card + Badge + Progress ring"

must_haves:
  truths:
    - "shadcn-vue progress component is installed"
    - "EvidenceTierBadge.vue has zero Vuetify component tags"
    - "TierHelpDialog.vue has zero Vuetify component tags"
    - "ScoreBreakdown.vue has zero Vuetify component tags"
    - "`npm run build` succeeds"
    - "`npm run lint` has 0 errors"
    - "Tier badges display correct colors and tooltips"
    - "Score breakdown shows inline, card, and compact variants correctly"
  artifacts:
    - path: "frontend/src/components/EvidenceTierBadge.vue"
      provides: "Tooltip + Badge tier display with color coding"
    - path: "frontend/src/components/TierHelpDialog.vue"
      provides: "Dialog explaining tier and group classifications"
    - path: "frontend/src/components/ScoreBreakdown.vue"
      provides: "Multi-variant score display (inline/card/compact)"

---

# 05-01: Shared Components Migration

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Migrate the 3 shared evidence components used across gene detail and evidence views.

**Architecture:** These components are used by multiple parent components (GeneDetail, EvidenceCard, GeneTable). Migrate them first to avoid breaking dependents.

---

<task id="1">
### Task 1: Install shadcn-vue progress component

```bash
cd frontend && npx shadcn-vue@latest add progress
```

Verify: `ls frontend/src/components/ui/progress/`

**Commit:**
```bash
git add frontend/src/components/ui/progress/
git commit -m "feat(05-01): install shadcn-vue progress component"
```
</task>

<task id="2" depends_on="1">
### Task 2: Migrate EvidenceTierBadge.vue

**Files:** Modify `frontend/src/components/EvidenceTierBadge.vue`

**Current:** Uses `v-tooltip` + `v-chip` with dynamic color/size props.

**Replace with:** Tooltip + Badge from shadcn-vue.

**Imports:**
```typescript
import { computed } from 'vue'
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip'
import { Badge } from '@/components/ui/badge'
import { getTierConfig } from '@/utils/evidenceTiers'
```

**Template pattern:**
```vue
<template>
  <TooltipProvider v-if="tier">
    <Tooltip>
      <TooltipTrigger as-child>
        <Badge
          :class="[
            sizeClasses,
            'cursor-help font-medium',
          ]"
          :style="{
            backgroundColor: tierConfig.color + '20',
            color: tierConfig.color,
            borderColor: tierConfig.color + '40',
          }"
          variant="outline"
        >
          <component :is="tierConfig.icon" :size="iconSize" class="mr-1" />
          {{ tierConfig.label }}
        </Badge>
      </TooltipTrigger>
      <TooltipContent>
        <p class="font-medium">{{ tierConfig.label }}</p>
        <p class="text-xs text-muted-foreground">{{ tierConfig.description }}</p>
      </TooltipContent>
    </Tooltip>
  </TooltipProvider>
</template>
```

**Computed for sizes:**
```typescript
const sizeClasses = computed(() => {
  switch (props.size) {
    case 'x-small': return 'text-[10px] px-1.5 py-0'
    case 'small': return 'text-xs px-2 py-0.5'
    default: return 'text-sm px-2.5 py-1'
  }
})
const iconSize = computed(() => props.size === 'x-small' ? 10 : props.size === 'small' ? 12 : 14)
```

**Remove:** All `v-tooltip`, `v-chip`, Vuetify utility classes, scoped styles for Vuetify focus states.

**Verify:** `npm run build && npm run lint`

**Commit:**
```bash
git add frontend/src/components/EvidenceTierBadge.vue
git commit -m "feat(05-01): migrate EvidenceTierBadge to Tooltip + Badge"
```
</task>

<task id="3" depends_on="1">
### Task 3: Migrate TierHelpDialog.vue

**Files:** Modify `frontend/src/components/TierHelpDialog.vue`

**Current:** Uses `v-dialog` (scrollable) + `v-btn` activator + `v-card` + `v-chip` + `v-alert`.

**Replace with:** Dialog + Card + Badge + Alert from shadcn-vue.

**Imports:**
```typescript
import { ref } from 'vue'
import {
  Dialog, DialogContent, DialogDescription, DialogHeader,
  DialogTitle, DialogTrigger, DialogFooter,
} from '@/components/ui/dialog'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Alert, AlertDescription } from '@/components/ui/alert'
import { Separator } from '@/components/ui/separator'
import { ScrollArea } from '@/components/ui/scroll-area'
import { CircleHelp, Info } from 'lucide-vue-next'
import { TIER_CONFIG, GROUP_CONFIG } from '@/utils/evidenceTiers'
```

**Template pattern:**
```vue
<template>
  <Dialog v-model:open="showDialog">
    <DialogTrigger as-child>
      <Button variant="ghost" size="icon" class="h-8 w-8">
        <CircleHelp :size="16" />
      </Button>
    </DialogTrigger>
    <DialogContent class="max-w-[700px] max-h-[80vh]">
      <DialogHeader>
        <DialogTitle>Evidence Classification Guide</DialogTitle>
        <DialogDescription>Understanding evidence tiers and groups</DialogDescription>
      </DialogHeader>
      <ScrollArea class="max-h-[60vh] pr-4">
        <!-- Evidence Groups section -->
        <h3 class="text-base font-semibold mb-3">Evidence Groups</h3>
        <div class="space-y-2 mb-6">
          <div v-for="group in GROUP_CONFIG" :key="group.label" class="flex items-start gap-3 p-2 rounded-md border">
            <component :is="group.icon" :size="18" :style="{ color: group.color }" class="mt-0.5 shrink-0" />
            <div>
              <Badge :style="{ backgroundColor: group.color + '20', color: group.color }" variant="outline">
                {{ group.label }}
              </Badge>
              <p class="text-xs text-muted-foreground mt-1">{{ group.description }}</p>
            </div>
          </div>
        </div>

        <Separator class="my-4" />

        <!-- Evidence Tiers section -->
        <h3 class="text-base font-semibold mb-3">Evidence Tiers</h3>
        <div class="space-y-2 mb-6">
          <div v-for="tier in TIER_CONFIG" :key="tier.label" class="flex items-start gap-3 p-2 rounded-md border">
            <component :is="tier.icon" :size="18" :style="{ color: tier.color }" class="mt-0.5 shrink-0" />
            <div>
              <Badge :style="{ backgroundColor: tier.color + '20', color: tier.color }" variant="outline">
                {{ tier.label }}
              </Badge>
              <p class="text-xs text-muted-foreground mt-1">{{ tier.description }}</p>
            </div>
          </div>
        </div>

        <!-- Info alert -->
        <Alert>
          <Info :size="16" />
          <AlertDescription class="text-xs">
            Evidence tiers are automatically computed from aggregated source scores.
            ClinGen classifications are curator-assigned and take precedence.
          </AlertDescription>
        </Alert>
      </ScrollArea>
      <DialogFooter>
        <Button variant="outline" @click="showDialog = false">Close</Button>
      </DialogFooter>
    </DialogContent>
  </Dialog>
</template>
```

**Remove:** All `v-dialog`, `v-card`, `v-chip`, `v-alert`, `v-btn`, `v-spacer`, `v-divider` tags and Vuetify utility classes.

**Verify:** `npm run build && npm run lint`

**Commit:**
```bash
git add frontend/src/components/TierHelpDialog.vue
git commit -m "feat(05-01): migrate TierHelpDialog to Dialog + Badge + Alert"
```
</task>

<task id="4" depends_on="1">
### Task 4: Migrate ScoreBreakdown.vue

**Files:** Modify `frontend/src/components/ScoreBreakdown.vue`

**Current:** Uses `v-tooltip`, `v-chip`, `v-card`, `v-avatar`, `v-progress-circular` (as donut chart), `v-divider`, `v-row`, `v-col`. Has 3 display variants: inline, card, compact.

**Key replacement decisions:**
- `v-progress-circular` (donut) → CSS ring or SVG circle (simpler than Progress component for donut visualization)
- `v-chip` → Badge
- `v-tooltip` → Tooltip
- `v-card` → Card (for card variant)
- `v-avatar` → Avatar
- `v-divider` → Separator

**Score donut replacement (SVG circle):**
```vue
<!-- Replace v-progress-circular donut with SVG -->
<div class="relative inline-flex items-center justify-center">
  <svg :width="donutSize" :height="donutSize" class="-rotate-90">
    <!-- Background circle -->
    <circle
      :cx="donutSize / 2" :cy="donutSize / 2"
      :r="donutRadius"
      fill="none"
      stroke="currentColor"
      class="text-muted/20"
      :stroke-width="donutStroke"
    />
    <!-- Score arc -->
    <circle
      :cx="donutSize / 2" :cy="donutSize / 2"
      :r="donutRadius"
      fill="none"
      :stroke="scoreColor"
      :stroke-width="donutStroke"
      :stroke-dasharray="circumference"
      :stroke-dashoffset="circumference - (circumference * (score ?? 0)) / 100"
      stroke-linecap="round"
    />
  </svg>
  <span class="absolute text-sm font-bold" :style="{ color: scoreColor }">
    {{ score ?? '—' }}
  </span>
</div>
```

```typescript
const donutSize = computed(() => props.variant === 'card' ? 80 : 48)
const donutStroke = computed(() => props.variant === 'card' ? 8 : 4)
const donutRadius = computed(() => (donutSize.value - donutStroke.value) / 2)
const circumference = computed(() => 2 * Math.PI * donutRadius.value)
```

**Inline variant pattern:**
```vue
<TooltipProvider v-if="variant === 'inline'">
  <Tooltip>
    <TooltipTrigger as-child>
      <Badge
        class="cursor-help"
        :style="{ backgroundColor: scoreColor + '20', color: scoreColor }"
        variant="outline"
      >
        <component :is="scoreIcon" :size="12" class="mr-1" />
        {{ score ?? '—' }}
      </Badge>
    </TooltipTrigger>
    <TooltipContent class="max-w-xs">
      <p class="font-medium mb-1">{{ scoreClassification }} ({{ score }}/100)</p>
      <p class="text-xs text-muted-foreground">{{ getScoreExplanation(score) }}</p>
      <!-- Source breakdown list -->
      <div v-if="sortedBreakdown.length" class="mt-2 space-y-1">
        <div v-for="item in topSources" :key="item.source" class="flex justify-between text-xs">
          <span>{{ sourceAbbreviation(item.source) }}</span>
          <span class="font-mono">{{ item.score.toFixed(1) }}</span>
        </div>
        <p v-if="remainingCount > 0" class="text-xs text-muted-foreground">
          +{{ remainingCount }} more
        </p>
      </div>
    </TooltipContent>
  </Tooltip>
</TooltipProvider>
```

**Card variant** uses Card + SVG donut + source breakdown grid.

**Compact variant** is similar to inline but with visible source badges.

**Preserve all computed logic** (scoreColor, scoreClassification, scoreIcon, sortedBreakdown, topSources, sourceAbbreviation, getSubScoreColor, getSourceDescription).

**Remove:** All `v-tooltip`, `v-chip`, `v-card`, `v-avatar`, `v-progress-circular`, `v-divider`, `v-row`, `v-col` tags. Remove all Vuetify utility classes.

**Verify:** `npm run build && npm run lint`

**Commit:**
```bash
git add frontend/src/components/ScoreBreakdown.vue
git commit -m "feat(05-01): migrate ScoreBreakdown to SVG donut + Badge + Tooltip"
```
</task>

<task id="5" depends_on="2,3,4">
### Task 5: Verification

**Build + lint:**
```bash
cd frontend && npm run build && npm run lint
```

**Vuetify audit:**
```bash
grep -E "v-tooltip|v-chip|v-card|v-dialog|v-btn|v-alert|v-avatar|v-progress-circular|v-divider|v-row|v-col|v-spacer" \
  frontend/src/components/EvidenceTierBadge.vue \
  frontend/src/components/TierHelpDialog.vue \
  frontend/src/components/ScoreBreakdown.vue
```
Expected: 0 matches.

**Visual verification:**
- Navigate to a gene detail page — tier badges show with correct colors
- Click the help icon — tier/group classification dialog opens and scrolls
- Score breakdown displays correctly in all 3 variants
- Tooltips appear on hover for scores and badges
</task>
