---
phase: "07"
plan: "07-04"
title: "AdminAnnotations, AdminLogViewer, AdminGeneStaging, AdminHybridSources, AdminReleases"
wave: 4
depends_on: ["07-03"]
files_modified:
  - "frontend/src/views/admin/AdminAnnotations.vue"
  - "frontend/src/views/admin/AdminLogViewer.vue"
  - "frontend/src/views/admin/AdminGeneStaging.vue"
  - "frontend/src/views/admin/AdminHybridSources.vue"
  - "frontend/src/views/admin/AdminReleases.vue"
autonomous: true
estimated_minutes: 120
requirements:
  - "ADMIN-12: AdminAnnotations uses Card + Select + Switch + DataTable"
  - "ADMIN-13: AdminLogViewer uses DataTable (server-side) + Dialog (tabbed)"
  - "ADMIN-14: AdminGeneStaging uses DataTable with row selection + Dialog"
  - "ADMIN-15: AdminHybridSources uses Tabs + file upload + DataTable"
  - "ADMIN-16: AdminReleases uses DataTable + Dialog"

must_haves:
  truths:
    - "All 5 files have zero Vuetify component tags"
    - "`npm run build` succeeds"
    - "`npm run lint` has 0 errors"
    - "AdminAnnotations pipeline controls work (strategy select, source toggle, force switch)"
    - "AdminLogViewer server-side pagination and filtering work"
    - "AdminGeneStaging row selection and approve/reject dialogs work"
    - "AdminHybridSources file upload with drag-drop works"
    - "AdminReleases create/edit/publish/delete operations work"

---

# 07-04: Complex Admin Views

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Migrate the 5 most complex admin views. These are the largest files (939-1144 lines) with the most diverse Vuetify usage.

---

<task id="1">
### Task 1: Migrate AdminAnnotations.vue

**Files:** Modify `frontend/src/views/admin/AdminAnnotations.vue` (939 lines)

**Key replacements:**
- `v-container` → Tailwind container
- `v-card` sections → Card
- `v-alert` → Alert
- `v-chip` / `v-chip-group` → Badge / `<div class="flex flex-wrap gap-1">`
- `v-select` (strategy dropdown) → Select
- `v-switch` (force update) → Switch
- `v-expand-transition` (selective sources) → Collapsible
- `v-data-table` (annotation sources, scheduled jobs) → DataTable
- `v-dialog` (source details) → Dialog
- `v-btn` → Button
- `v-list`/`v-list-item` → styled divs
- `v-text-field` → Input
- `v-divider` → Separator

**Pipeline control section:**
```vue
<Card>
  <CardHeader>
    <CardTitle>Pipeline Control</CardTitle>
  </CardHeader>
  <CardContent class="space-y-4">
    <!-- Strategy select -->
    <div class="space-y-2">
      <Label>Update Strategy</Label>
      <Select v-model="pipelineForm.strategy">
        <SelectTrigger><SelectValue /></SelectTrigger>
        <SelectContent>
          <SelectItem value="incremental">Incremental</SelectItem>
          <SelectItem value="full">Full Update</SelectItem>
          <SelectItem value="forced">Forced</SelectItem>
          <SelectItem value="selective">Selective Sources</SelectItem>
        </SelectContent>
      </Select>
    </div>
    <!-- Selective source picker (shown when strategy=selective) -->
    <Collapsible :open="pipelineForm.strategy === 'selective'">
      <CollapsibleContent>
        <div class="flex flex-wrap gap-2 p-3 rounded-md border">
          <Badge
            v-for="source in availableSources"
            :key="source"
            :variant="pipelineForm.sources.includes(source) ? 'default' : 'outline'"
            class="cursor-pointer"
            @click="toggleSource(source)"
          >
            {{ source }}
          </Badge>
        </div>
      </CollapsibleContent>
    </Collapsible>
    <!-- Force update switch -->
    <div class="flex items-center gap-2">
      <Switch v-model:checked="pipelineForm.force" />
      <Label>Force update (re-fetch existing)</Label>
    </div>
    <!-- Run button -->
    <Button :disabled="pipelineLoading" @click="triggerPipeline">
      <Play :size="14" class="mr-2" />
      {{ pipelineLoading ? 'Running...' : 'Run Pipeline' }}
    </Button>
  </CardContent>
</Card>
```

**Gene annotation lookup section:**
```vue
<Card>
  <CardHeader><CardTitle>Gene Annotation Lookup</CardTitle></CardHeader>
  <CardContent>
    <div class="flex gap-2">
      <Input v-model="lookupGeneId" placeholder="Gene symbol or HGNC ID" class="flex-1" />
      <Select v-model="lookupSource">
        <SelectTrigger class="w-[180px]"><SelectValue placeholder="All sources" /></SelectTrigger>
        <SelectContent>
          <SelectItem value="">All sources</SelectItem>
          <SelectItem v-for="src in availableSources" :key="src" :value="src">{{ src }}</SelectItem>
        </SelectContent>
      </Select>
      <Button :disabled="lookupLoading" @click="lookupAnnotation">
        <Search :size="14" class="mr-1" /> Lookup
      </Button>
    </div>
    <Alert v-if="lookupResult" class="mt-3">
      <AlertDescription>
        <pre class="text-xs overflow-x-auto">{{ JSON.stringify(lookupResult, null, 2) }}</pre>
      </AlertDescription>
    </Alert>
  </CardContent>
</Card>
```

**Data tables:** Use TanStack Table for annotation sources table and scheduled jobs table.

**Commit:**
```bash
git add frontend/src/views/admin/AdminAnnotations.vue
git commit -m "feat(07-04): migrate AdminAnnotations to Card + Select + Switch + DataTable"
```
</task>

<task id="2">
### Task 2: Migrate AdminLogViewer.vue

**Files:** Modify `frontend/src/views/admin/AdminLogViewer.vue` (1144 lines)

**Key replacements:**
- `v-container` → Tailwind container
- `v-select` (level, time range, sort, items per page) → Select
- `v-text-field` (source, request ID, search) → Input
- `v-data-table-server` → DataTable (with `manualPagination: true`)
- `v-pagination` → DataTablePagination
- `v-chip` (log level, status code, HTTP method) → Badge
- `v-dialog` (log details) → Dialog
- `v-tabs` (details tabs) → Tabs
- `v-list`/`v-list-item` → styled divs
- `v-alert` → Alert
- `v-btn` → Button
- `v-divider` → Separator

**This is the second server-side paginated table** (after GeneTable). Use same pattern:

```typescript
const table = useVueTable({
  get data() { return logs.value },
  columns: logColumns,
  getCoreRowModel: getCoreRowModel(),
  manualPagination: true,
  get pageCount() { return Math.ceil(totalLogs.value / itemsPerPage.value) },
  state: {
    get pagination() { return { pageIndex: currentPage.value - 1, pageSize: itemsPerPage.value } },
  },
  onPaginationChange: (updater) => { /* update state + fetch */ },
})
```

**Log details dialog with tabs:**
```vue
<Dialog v-model:open="showDetailsDialog">
  <DialogContent class="max-w-[700px] max-h-[80vh]">
    <DialogHeader>
      <DialogTitle>Log Entry Details</DialogTitle>
    </DialogHeader>
    <Tabs v-model="detailsTab" class="w-full">
      <TabsList class="grid w-full grid-cols-5">
        <TabsTrigger value="overview">Overview</TabsTrigger>
        <TabsTrigger value="request">Request</TabsTrigger>
        <TabsTrigger value="response">Response</TabsTrigger>
        <TabsTrigger value="error">Error</TabsTrigger>
        <TabsTrigger value="context">Context</TabsTrigger>
      </TabsList>
      <ScrollArea class="max-h-[50vh] mt-4">
        <TabsContent value="overview">
          <!-- Overview list items -->
        </TabsContent>
        <TabsContent value="request">
          <pre class="text-xs bg-muted p-3 rounded overflow-x-auto">{{ formatJson(selectedLog?.request) }}</pre>
        </TabsContent>
        <!-- ... other tabs ... -->
      </ScrollArea>
    </Tabs>
  </DialogContent>
</Dialog>
```

**Level badges with color:**
```typescript
function getLevelVariant(level: string) {
  switch (level) {
    case 'ERROR': case 'CRITICAL': return 'destructive'
    case 'WARNING': return 'warning' // or use inline style
    case 'INFO': return 'default'
    case 'DEBUG': return 'secondary'
    default: return 'outline'
  }
}
```

**Commit:**
```bash
git add frontend/src/views/admin/AdminLogViewer.vue
git commit -m "feat(07-04): migrate AdminLogViewer to DataTable (server-side) + Tabs dialog"
```
</task>

<task id="3">
### Task 3: Migrate AdminGeneStaging.vue

**Files:** Modify `frontend/src/views/admin/AdminGeneStaging.vue` (824 lines)

**Key replacements:**
- `v-data-table` with `show-select` → DataTable with Checkbox column + row selection
- `v-dialog` (approve/reject/details) → Dialog
- `v-textarea` → native textarea or Textarea component
- `v-text-field` → Input
- `v-select` → Select
- `v-switch` → Switch
- `v-chip` → Badge
- `v-alert` → Alert
- `v-list` → styled divs

**Row selection with TanStack Table:**
```typescript
const columns: ColumnDef<StagingItem>[] = [
  {
    id: 'select',
    header: ({ table }) => h(Checkbox, {
      checked: table.getIsAllPageRowsSelected(),
      'onUpdate:checked': (value: boolean) => table.toggleAllPageRowsSelected(!!value),
    }),
    cell: ({ row }) => h(Checkbox, {
      checked: row.getIsSelected(),
      'onUpdate:checked': (value: boolean) => row.toggleSelected(!!value),
    }),
    enableSorting: false,
    enableHiding: false,
    size: 40,
  },
  // ... other columns
]

const table = useVueTable({
  // ...
  enableRowSelection: true,
})
```

**Approve dialog** uses Dialog + Input + Label.
**Reject dialog** uses AlertDialog (destructive) with textarea for reason.

**Commit:**
```bash
git add frontend/src/views/admin/AdminGeneStaging.vue
git commit -m "feat(07-04): migrate AdminGeneStaging to DataTable with row selection + Dialog"
```
</task>

<task id="4">
### Task 4: Migrate AdminHybridSources.vue

**Files:** Modify `frontend/src/views/admin/AdminHybridSources.vue` (756 lines)

**Key replacements:**
- `v-tabs`/`v-tab` (source selector) → Tabs
- `v-window`/`v-window-item` (view tabs within source) → Tabs (nested)
- `v-radio-group`/`v-radio` → RadioGroup / RadioGroupItem from shadcn-vue
- `v-text-field` → Input
- `v-alert` → Alert
- `v-progress-linear` → Progress
- `v-data-table` → DataTable
- `v-chip` → Badge
- `v-dialog` → AlertDialog (delete confirmations)
- `v-btn` → Button
- `v-list`/`v-list-item` → styled divs

**Install RadioGroup if not available:**
```bash
cd frontend && npx shadcn-vue@latest add radio-group
```

**File upload zone** — keep the existing drag-and-drop logic, just replace the styling:
```vue
<div
  class="border-2 border-dashed rounded-lg p-8 text-center transition-colors"
  :class="isDragging ? 'border-primary bg-primary/5' : 'border-border'"
  @dragenter.prevent="isDragging = true"
  @dragleave.prevent="isDragging = false"
  @dragover.prevent
  @drop.prevent="handleDrop"
>
  <Upload :size="32" class="mx-auto mb-4 text-muted-foreground" />
  <p class="text-sm text-muted-foreground mb-2">
    Drag and drop a file here, or
  </p>
  <Button variant="outline" @click="browseFiles">Browse Files</Button>
  <input ref="fileInput" type="file" class="hidden" :accept="acceptedTypes" @change="handleFileSelect" />
</div>
```

**Upload mode selection:**
```vue
<RadioGroup v-model="uploadMode" class="flex gap-4">
  <div class="flex items-center space-x-2">
    <RadioGroupItem value="merge" id="merge" />
    <Label for="merge">Merge (add new)</Label>
  </div>
  <div class="flex items-center space-x-2">
    <RadioGroupItem value="replace" id="replace" />
    <Label for="replace">Replace (overwrite)</Label>
  </div>
</RadioGroup>
```

**Commit:**
```bash
git add frontend/src/views/admin/AdminHybridSources.vue
git commit -m "feat(07-04): migrate AdminHybridSources to Tabs + RadioGroup + DataTable"
```
</task>

<task id="5">
### Task 5: Migrate AdminReleases.vue

**Files:** Modify `frontend/src/views/admin/AdminReleases.vue`

**Key replacements:**
- `v-data-table` → DataTable
- `v-dialog` (create/edit, publish, delete, details) → Dialog / AlertDialog
- `v-form` + `v-text-field` → Input + Label
- `v-textarea` → native textarea
- `v-chip` → Badge
- `v-alert` → Alert
- `v-btn` → Button
- `v-list`/`v-list-item` → styled divs

**Release status badges:**
```typescript
function getStatusVariant(status: string) {
  switch (status) {
    case 'published': return 'default'
    case 'draft': return 'secondary'
    default: return 'outline'
  }
}
```

**Publish confirmation** uses AlertDialog with steps list.

**Commit:**
```bash
git add frontend/src/views/admin/AdminReleases.vue
git commit -m "feat(07-04): migrate AdminReleases to DataTable + Dialog"
```
</task>

<task id="6" depends_on="1,2,3,4,5">
### Task 6: Phase 07 Full Verification

```bash
cd frontend && npm run build && npm run lint
```

**Vuetify audit on ALL Phase 07 files:**
```bash
grep -rE "v-container|v-card|v-data-table|v-dialog|v-form|v-text-field|v-select|v-switch|v-chip|v-btn|v-alert|v-tabs|v-list|v-progress|v-navigation-drawer|v-toolbar|v-pagination|v-radio|v-textarea|v-expansion-panel|v-expand-transition|v-row|v-col|v-divider|v-spacer|v-tooltip|v-autocomplete|v-checkbox|v-badge|v-avatar|v-menu|v-window|v-chip-group|v-timeline|v-stepper" \
  frontend/src/views/admin/ \
  frontend/src/components/admin/ \
  frontend/src/components/DataSourceProgress.vue \
  --include="*.vue"
```
Expected: 0 matches.

**Visual verification:**
- All 11 admin views render correctly
- User CRUD: create, edit, toggle status, delete
- Cache: view namespaces, clear, warm
- Pipeline: real-time progress updates via WebSocket
- Annotations: strategy select, source toggle, gene lookup
- Log viewer: server-side pagination, filter by level, tabbed details
- Gene staging: row selection, approve/reject dialogs
- Hybrid sources: file upload drag-drop, merge/replace toggle
- Releases: create, edit, publish, delete
- Backups: create, restore, details, delete
- Settings: edit with reason, view history
</task>
