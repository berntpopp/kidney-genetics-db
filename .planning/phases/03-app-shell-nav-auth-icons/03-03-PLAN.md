---
phase: "03"
plan: "03-03"
title: "Auth Modals and Auth Pages"
wave: 3
depends_on: ["03-01", "03-02"]
files_modified:
  - "frontend/src/components/auth/LoginModal.vue"
  - "frontend/src/components/auth/ForgotPasswordModal.vue"
  - "frontend/src/components/auth/ChangePasswordModal.vue"
  - "frontend/src/views/Login.vue"
  - "frontend/src/views/ForgotPassword.vue"
  - "frontend/src/layouts/AppHeader.vue"
autonomous: true
estimated_minutes: 35
requirements:
  - "AUTH-01"
  - "AUTH-02"
  - "AUTH-03"
  - "AUTH-04"

must_haves:
  truths:
    - "LoginModal opens/closes via v-model:open controlled by AppHeader (no embedded activator)"
    - "Login success emits 'login-success', parent shows toast via vue-sonner and closes modal (NO router.go(0))"
    - "ForgotPasswordModal opens/closes via v-model:open, sends reset email via authStore.requestPasswordReset"
    - "ChangePasswordModal shows 5 password complexity requirements as a live checklist with Check/Circle Lucide icons"
    - "All auth forms use vee-validate useForm + defineField with static Zod schemas (NOT inside computed)"
    - "Validation triggers: validateOnBlur: true + validateOnInput: true on all defineField calls"
    - "Standalone Login.vue renders a centered Card layout with the same Zod login schema"
    - "Standalone ForgotPassword.vue renders a centered Card layout with the same Zod email schema"
    - "Zero v-dialog, v-form, v-text-field, v-alert, v-card references in any auth file after migration"
  artifacts:
    - path: "frontend/src/components/auth/LoginModal.vue"
      provides: "Dialog + vee-validate login form with controlled open/close and login-success emit"
    - path: "frontend/src/components/auth/ForgotPasswordModal.vue"
      provides: "Dialog + vee-validate email form for password reset requests"
    - path: "frontend/src/components/auth/ChangePasswordModal.vue"
      provides: "Dialog + vee-validate password change form with live complexity checklist"
    - path: "frontend/src/views/Login.vue"
      provides: "Standalone login page with Card layout, Zod schema, redirect-after-login"
    - path: "frontend/src/views/ForgotPassword.vue"
      provides: "Standalone forgot-password page with Card layout, Zod email schema"
  key_links:
    - from: "frontend/src/layouts/AppHeader.vue"
      to: "frontend/src/components/auth/LoginModal.vue"
      via: "v-model:open + @login-success event"
    - from: "frontend/src/components/auth/LoginModal.vue"
      to: "frontend/src/stores/auth.ts"
      via: "authStore.login() for credential submission"
    - from: "frontend/src/components/auth/LoginModal.vue"
      to: "frontend/src/components/auth/ForgotPasswordModal.vue"
      via: "Forgot Password link opens ForgotPasswordModal"
    - from: "frontend/src/components/auth/ChangePasswordModal.vue"
      to: "frontend/src/stores/auth.ts"
      via: "authStore.changePassword() for password update"
    - from: "frontend/src/views/Login.vue"
      to: "frontend/src/stores/auth.ts"
      via: "authStore.login() with redirect from route.query.redirect"
---

# Plan 03-03: Auth Modals and Auth Pages

## Context

This plan migrates all authentication UI from Vuetify to shadcn-vue Dialog + vee-validate + Zod. It covers three modal components (LoginModal, ForgotPasswordModal, ChangePasswordModal) and two standalone page views (Login.vue, ForgotPassword.vue).

All shadcn-vue components (Dialog, Form, Input, Label, Card, Button, Separator) and validation libraries (vee-validate, @vee-validate/zod, zod) were installed in 03-01. The AppHeader.vue layout was created in 03-01 and UserMenu was migrated in 03-02. This plan wires LoginModal into the header with the controlled `v-model:open` pattern.

Key design decisions (from approved design):
1. **Controlled modal pattern**: Parent (AppHeader) controls open/close via `v-model:open`. No `<template #activator>` inside modals.
2. **Static Zod schemas**: Top-level `const`, never inside `computed()` (preserves TypeScript inference).
3. **Validation trigger**: `validateOnBlur: true` + `validateOnInput: true` on every `defineField()`.
4. **Login success flow**: `authStore.login()` resolves -> emit `login-success` -> parent closes modal + shows toast. NO `router.go(0)`.
5. **Password complexity**: Live checklist with 5 requirements, Check/Circle icons, green/muted colors.
6. **Standalone pages**: Same Zod schemas in centered Card layout (no Dialog wrapper).

Reference files:
- @frontend/src/components/auth/LoginModal.vue (current Vuetify version)
- @frontend/src/components/auth/ForgotPasswordModal.vue (current Vuetify version)
- @frontend/src/components/auth/ChangePasswordModal.vue (current Vuetify version)
- @frontend/src/views/Login.vue (current Vuetify standalone page)
- @frontend/src/views/ForgotPassword.vue (current Vuetify standalone page)
- @frontend/src/stores/auth.ts (auth store API surface)
- @frontend/src/layouts/AppHeader.vue (created in 03-01, wired in 03-02)
- @.planning/phases/03-app-shell-nav-auth-icons/03-RESEARCH.md (patterns 6, 7)
- @.planning/phases/03-app-shell-nav-auth-icons/03-CONTEXT.md (locked decisions)

## Tasks

<task id="1">
### Task 1: Rewrite LoginModal.vue with Dialog + vee-validate + Zod

Rewrite `frontend/src/components/auth/LoginModal.vue` completely. Remove all Vuetify components. Use shadcn-vue Dialog controlled by parent via props/emits. Use vee-validate + Zod for form validation.

**Current behavior to preserve:**
- Username/password fields with required validation
- Show/hide password toggle
- Error display from `authStore.error`
- Loading state from `authStore.isLoading`
- "Forgot Password?" link that opens ForgotPasswordModal
- Form clears when dialog opens
- Login calls `authStore.login(username, password)`

**Behavior changes (intentional):**
- Remove embedded `<template #activator>` button -- parent controls open/close
- Remove `router.go(0)` on success -- emit `login-success` event instead
- Use Zod schema validation instead of hand-rolled rules
- Use `<Input>` instead of `<v-text-field>`
- Use `<Dialog>` instead of `<v-dialog>`

**Complete replacement file:**

```vue
<script setup lang="ts">
import { ref, watch } from 'vue'
import { z } from 'zod'
import { toTypedSchema } from '@vee-validate/zod'
import { useForm } from 'vee-validate'
import { useAuthStore } from '@/stores/auth'
import ForgotPasswordModal from './ForgotPasswordModal.vue'
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogFooter,
} from '@/components/ui/dialog'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Button } from '@/components/ui/button'
import { Eye, EyeOff, CircleUser } from 'lucide-vue-next'

const props = defineProps<{
  open: boolean
}>()

const emit = defineEmits<{
  'update:open': [value: boolean]
  'login-success': [username: string]
}>()

const authStore = useAuthStore()

// Static Zod schema -- NOT inside computed (preserves type inference)
const loginSchema = toTypedSchema(
  z.object({
    username: z.string().min(1, 'Username or email is required'),
    password: z.string().min(1, 'Password is required'),
  })
)

const { handleSubmit, defineField, errors, resetForm } = useForm({
  validationSchema: loginSchema,
})

const [username, usernameAttrs] = defineField('username', {
  validateOnBlur: true,
  validateOnInput: true,
})
const [password, passwordAttrs] = defineField('password', {
  validateOnBlur: true,
  validateOnInput: true,
})

const showPassword = ref(false)
const forgotPasswordOpen = ref(false)

const onSubmit = handleSubmit(async (values) => {
  const success = await authStore.login(values.username, values.password)
  if (success) {
    emit('login-success', authStore.user?.username ?? values.username)
    // Parent (AppHeader) handles closing the modal and showing toast
  }
})

const closeDialog = () => {
  emit('update:open', false)
}

const openForgotPassword = () => {
  emit('update:open', false)
  forgotPasswordOpen.value = true
}

// Clear form and errors when dialog opens
watch(
  () => props.open,
  (isOpen) => {
    if (isOpen) {
      resetForm()
      showPassword.value = false
      authStore.clearError()
    }
  }
)
</script>

<template>
  <Dialog :open="open" @update:open="emit('update:open', $event)">
    <DialogContent class="sm:max-w-[400px]">
      <DialogHeader>
        <div class="flex items-center gap-2">
          <CircleUser class="size-5 text-primary" />
          <DialogTitle>Login</DialogTitle>
        </div>
        <DialogDescription>
          Sign in with your username or email
        </DialogDescription>
      </DialogHeader>

      <form class="space-y-4" @submit.prevent="onSubmit">
        <div class="space-y-2">
          <Label for="login-username">Username or Email</Label>
          <Input
            id="login-username"
            v-model="username"
            v-bind="usernameAttrs"
            type="text"
            placeholder="Enter username or email"
            :disabled="authStore.isLoading"
            :class="{ 'border-destructive': errors.username }"
          />
          <p v-if="errors.username" class="text-sm text-destructive">
            {{ errors.username }}
          </p>
        </div>

        <div class="space-y-2">
          <Label for="login-password">Password</Label>
          <div class="relative">
            <Input
              id="login-password"
              v-model="password"
              v-bind="passwordAttrs"
              :type="showPassword ? 'text' : 'password'"
              placeholder="Enter password"
              :disabled="authStore.isLoading"
              class="pr-10"
              :class="{ 'border-destructive': errors.password }"
            />
            <Button
              type="button"
              variant="ghost"
              size="icon"
              class="absolute right-0 top-0 h-full px-3 hover:bg-transparent"
              :disabled="authStore.isLoading"
              @click="showPassword = !showPassword"
            >
              <EyeOff v-if="showPassword" class="size-4 text-muted-foreground" />
              <Eye v-else class="size-4 text-muted-foreground" />
            </Button>
          </div>
          <p v-if="errors.password" class="text-sm text-destructive">
            {{ errors.password }}
          </p>
        </div>

        <div class="flex justify-end">
          <Button
            type="button"
            variant="link"
            size="sm"
            class="px-0 text-primary"
            :disabled="authStore.isLoading"
            @click="openForgotPassword"
          >
            Forgot Password?
          </Button>
        </div>

        <div
          v-if="authStore.error"
          class="rounded-md border border-destructive/50 bg-destructive/10 p-3 text-sm text-destructive"
        >
          {{ authStore.error }}
        </div>

        <DialogFooter class="gap-2 sm:gap-0">
          <Button
            type="button"
            variant="outline"
            :disabled="authStore.isLoading"
            @click="closeDialog"
          >
            Cancel
          </Button>
          <Button
            type="submit"
            :disabled="authStore.isLoading"
          >
            <span v-if="authStore.isLoading" class="flex items-center gap-2">
              <span class="size-4 animate-spin rounded-full border-2 border-current border-t-transparent" />
              Signing in...
            </span>
            <span v-else>Login</span>
          </Button>
        </DialogFooter>
      </form>
    </DialogContent>
  </Dialog>

  <ForgotPasswordModal v-model:open="forgotPasswordOpen" />
</template>
```

**Verify:** `npm run build` passes. No `v-dialog`, `v-form`, `v-text-field`, `v-card`, `v-alert`, `v-btn` references remain in LoginModal.vue.
</task>

<task id="2" depends_on="1">
### Task 2: Wire LoginModal into AppHeader.vue (v-model:open + toast on success)

Update `frontend/src/layouts/AppHeader.vue` (created in 03-01) to:

1. Import LoginModal and wire it with `v-model:open` pattern
2. Show a login button (when not authenticated) that sets `loginModalOpen = true`
3. Handle `@login-success` event: close modal + show toast

**Changes to AppHeader.vue:**

Add to the `<script setup>` section:

```typescript
import { ref } from 'vue'
import { toast } from 'vue-sonner'
import LoginModal from '@/components/auth/LoginModal.vue'

const loginModalOpen = ref(false)

const handleLoginSuccess = (username: string) => {
  loginModalOpen.value = false
  toast.success(`Logged in as ${username}`, { duration: 5000 })
}
```

In the template, replace the existing login button/link (which currently navigates to `/login`) with:

```vue
<!-- In the desktop right-side area, when NOT authenticated -->
<Button
  v-if="!authStore.isAuthenticated"
  variant="default"
  size="sm"
  @click="loginModalOpen = true"
>
  <LogIn class="mr-2 size-4" />
  Login
</Button>

<!-- At the end of the template (before closing tag) -->
<LoginModal
  v-model:open="loginModalOpen"
  @login-success="handleLoginSuccess"
/>
```

In the mobile Sheet drawer, also add a login trigger:

```vue
<!-- In the mobile drawer, when NOT authenticated -->
<Button
  v-if="!authStore.isAuthenticated"
  variant="default"
  class="w-full"
  @click="loginModalOpen = true; drawerOpen = false"
>
  <LogIn class="mr-2 size-4" />
  Login
</Button>
```

Import `LogIn` from `lucide-vue-next` if not already imported.

**Verify:** Clicking the header Login button opens the LoginModal dialog. After successful login, the dialog closes, a toast appears, and the header reactively shows the UserMenu.
</task>

<task id="3" depends_on="1">
### Task 3: Rewrite ForgotPasswordModal.vue with Dialog + vee-validate + Zod

Rewrite `frontend/src/components/auth/ForgotPasswordModal.vue` completely.

**Current behavior to preserve:**
- Email field with required + email format validation
- Calls `authStore.requestPasswordReset(email)`
- Shows success message on success, auto-closes after 3 seconds
- Shows `authStore.error` on failure
- Loading state from `authStore.isLoading`
- Form clears on open
- Controlled via `v-model` from parent

**Complete replacement file:**

```vue
<script setup lang="ts">
import { ref, watch } from 'vue'
import { z } from 'zod'
import { toTypedSchema } from '@vee-validate/zod'
import { useForm } from 'vee-validate'
import { useAuthStore } from '@/stores/auth'
import { toast } from 'vue-sonner'
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogFooter,
} from '@/components/ui/dialog'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Button } from '@/components/ui/button'
import { KeyRound } from 'lucide-vue-next'

const props = defineProps<{
  open: boolean
}>()

const emit = defineEmits<{
  'update:open': [value: boolean]
}>()

const authStore = useAuthStore()

// Static Zod schema
const forgotPasswordSchema = toTypedSchema(
  z.object({
    email: z
      .string()
      .min(1, 'Email is required')
      .email('Invalid email address'),
  })
)

const { handleSubmit, defineField, errors, resetForm } = useForm({
  validationSchema: forgotPasswordSchema,
})

const [email, emailAttrs] = defineField('email', {
  validateOnBlur: true,
  validateOnInput: true,
})

const submitted = ref(false)

const onSubmit = handleSubmit(async (values) => {
  const success = await authStore.requestPasswordReset(values.email)

  if (success) {
    submitted.value = true
    toast.success('Password reset instructions have been sent to your email.', {
      duration: 5000,
    })
    setTimeout(() => {
      closeDialog()
    }, 3000)
  }
})

const closeDialog = () => {
  emit('update:open', false)
}

// Clear form and errors when dialog opens
watch(
  () => props.open,
  (isOpen) => {
    if (isOpen) {
      resetForm()
      submitted.value = false
      authStore.clearError()
    }
  }
)
</script>

<template>
  <Dialog :open="open" @update:open="emit('update:open', $event)">
    <DialogContent class="sm:max-w-[400px]">
      <DialogHeader>
        <div class="flex items-center gap-2">
          <KeyRound class="size-5 text-primary" />
          <DialogTitle>Reset Password</DialogTitle>
        </div>
        <DialogDescription>
          Enter your email address and we'll send you instructions to reset your
          password.
        </DialogDescription>
      </DialogHeader>

      <form class="space-y-4" @submit.prevent="onSubmit">
        <div class="space-y-2">
          <Label for="forgot-email">Email Address</Label>
          <Input
            id="forgot-email"
            v-model="email"
            v-bind="emailAttrs"
            type="email"
            placeholder="Enter your email"
            :disabled="authStore.isLoading || submitted"
            :class="{ 'border-destructive': errors.email }"
          />
          <p v-if="errors.email" class="text-sm text-destructive">
            {{ errors.email }}
          </p>
        </div>

        <div
          v-if="submitted"
          class="rounded-md border border-green-500/50 bg-green-500/10 p-3 text-sm text-green-700 dark:text-green-400"
        >
          Password reset instructions have been sent to your email.
        </div>

        <div
          v-if="authStore.error"
          class="rounded-md border border-destructive/50 bg-destructive/10 p-3 text-sm text-destructive"
        >
          {{ authStore.error }}
        </div>

        <DialogFooter class="gap-2 sm:gap-0">
          <Button
            type="button"
            variant="outline"
            :disabled="authStore.isLoading"
            @click="closeDialog"
          >
            Cancel
          </Button>
          <Button
            type="submit"
            :disabled="authStore.isLoading || submitted"
          >
            <span v-if="authStore.isLoading" class="flex items-center gap-2">
              <span class="size-4 animate-spin rounded-full border-2 border-current border-t-transparent" />
              Sending...
            </span>
            <span v-else>Send Reset Email</span>
          </Button>
        </DialogFooter>
      </form>
    </DialogContent>
  </Dialog>
</template>
```

**Verify:** `npm run build` passes. No Vuetify references in ForgotPasswordModal.vue.
</task>

<task id="4" depends_on="1">
### Task 4: Rewrite ChangePasswordModal.vue with Dialog + Form + password complexity checklist

Rewrite `frontend/src/components/auth/ChangePasswordModal.vue` completely.

**Current behavior to preserve:**
- Current password field (plain password input)
- New password field with show/hide toggle
- Confirm password field
- Validation: required, minLength(8), complexity (upper, lower, number, special), passwords must match
- Calls `authStore.changePassword(currentPassword, newPassword)`
- Shows success message, auto-closes after 2 seconds
- Shows `authStore.error` on failure
- Loading state from `authStore.isLoading`
- Form clears on open
- Controlled via `v-model` from parent

**New behavior (from approved design):**
- Show 5 password complexity requirements as a live checklist below the new password field
- Each requirement shows a Check icon (green) when met or Circle icon (muted) when not met

**Complete replacement file:**

```vue
<script setup lang="ts">
import { ref, computed, watch } from 'vue'
import { z } from 'zod'
import { toTypedSchema } from '@vee-validate/zod'
import { useForm } from 'vee-validate'
import { useAuthStore } from '@/stores/auth'
import { toast } from 'vue-sonner'
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogFooter,
} from '@/components/ui/dialog'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Button } from '@/components/ui/button'
import { KeyRound, Eye, EyeOff, Check, Circle } from 'lucide-vue-next'

const props = defineProps<{
  open: boolean
}>()

const emit = defineEmits<{
  'update:open': [value: boolean]
}>()

const authStore = useAuthStore()

// Static Zod schema with all password constraints
const changePasswordSchema = toTypedSchema(
  z
    .object({
      currentPassword: z.string().min(1, 'Current password is required'),
      newPassword: z
        .string()
        .min(8, 'Minimum 8 characters')
        .regex(/[A-Z]/, 'Must contain an uppercase letter')
        .regex(/[a-z]/, 'Must contain a lowercase letter')
        .regex(/[0-9]/, 'Must contain a number')
        .regex(/[!@#$%^&*(),.?":{}|<>]/, 'Must contain a special character'),
      confirmPassword: z.string().min(1, 'Please confirm your new password'),
    })
    .refine((data) => data.newPassword === data.confirmPassword, {
      message: 'Passwords must match',
      path: ['confirmPassword'],
    })
)

const { handleSubmit, defineField, errors, resetForm } = useForm({
  validationSchema: changePasswordSchema,
})

const [currentPassword, currentPasswordAttrs] = defineField('currentPassword', {
  validateOnBlur: true,
  validateOnInput: true,
})
const [newPassword, newPasswordAttrs] = defineField('newPassword', {
  validateOnBlur: true,
  validateOnInput: true,
})
const [confirmPassword, confirmPasswordAttrs] = defineField('confirmPassword', {
  validateOnBlur: true,
  validateOnInput: true,
})

const showNewPassword = ref(false)

// Live password complexity checklist
const passwordRequirements = computed(() => [
  { label: 'At least 8 characters', met: (newPassword.value?.length ?? 0) >= 8 },
  { label: 'Uppercase letter (A\u2013Z)', met: /[A-Z]/.test(newPassword.value ?? '') },
  { label: 'Lowercase letter (a\u2013z)', met: /[a-z]/.test(newPassword.value ?? '') },
  { label: 'Number (0\u20139)', met: /[0-9]/.test(newPassword.value ?? '') },
  {
    label: 'Special character (!@#$%...)',
    met: /[!@#$%^&*(),.?":{}|<>]/.test(newPassword.value ?? ''),
  },
])

const onSubmit = handleSubmit(async (values) => {
  const success = await authStore.changePassword(
    values.currentPassword,
    values.newPassword
  )

  if (success) {
    toast.success('Password changed successfully!', { duration: 5000 })
    setTimeout(() => {
      closeDialog()
    }, 2000)
  }
})

const closeDialog = () => {
  emit('update:open', false)
}

// Clear form and errors when dialog opens
watch(
  () => props.open,
  (isOpen) => {
    if (isOpen) {
      resetForm()
      showNewPassword.value = false
      authStore.clearError()
    }
  }
)
</script>

<template>
  <Dialog :open="open" @update:open="emit('update:open', $event)">
    <DialogContent class="sm:max-w-[425px]">
      <DialogHeader>
        <div class="flex items-center gap-2">
          <KeyRound class="size-5 text-primary" />
          <DialogTitle>Change Password</DialogTitle>
        </div>
        <DialogDescription>
          Update your account password
        </DialogDescription>
      </DialogHeader>

      <form class="space-y-4" @submit.prevent="onSubmit">
        <!-- Current Password -->
        <div class="space-y-2">
          <Label for="change-current-password">Current Password</Label>
          <Input
            id="change-current-password"
            v-model="currentPassword"
            v-bind="currentPasswordAttrs"
            type="password"
            placeholder="Enter current password"
            :disabled="authStore.isLoading"
            :class="{ 'border-destructive': errors.currentPassword }"
          />
          <p v-if="errors.currentPassword" class="text-sm text-destructive">
            {{ errors.currentPassword }}
          </p>
        </div>

        <!-- New Password + complexity checklist -->
        <div class="space-y-2">
          <Label for="change-new-password">New Password</Label>
          <div class="relative">
            <Input
              id="change-new-password"
              v-model="newPassword"
              v-bind="newPasswordAttrs"
              :type="showNewPassword ? 'text' : 'password'"
              placeholder="Enter new password"
              :disabled="authStore.isLoading"
              class="pr-10"
              :class="{ 'border-destructive': errors.newPassword }"
            />
            <Button
              type="button"
              variant="ghost"
              size="icon"
              class="absolute right-0 top-0 h-full px-3 hover:bg-transparent"
              :disabled="authStore.isLoading"
              @click="showNewPassword = !showNewPassword"
            >
              <EyeOff v-if="showNewPassword" class="size-4 text-muted-foreground" />
              <Eye v-else class="size-4 text-muted-foreground" />
            </Button>
          </div>
          <p v-if="errors.newPassword" class="text-sm text-destructive">
            {{ errors.newPassword }}
          </p>

          <!-- Password complexity checklist -->
          <ul class="mt-2 space-y-1 text-xs">
            <li
              v-for="req in passwordRequirements"
              :key="req.label"
              class="flex items-center gap-2"
              :class="
                req.met
                  ? 'text-green-600 dark:text-green-400'
                  : 'text-muted-foreground'
              "
            >
              <Check v-if="req.met" class="size-3" />
              <Circle v-else class="size-3" />
              {{ req.label }}
            </li>
          </ul>
        </div>

        <!-- Confirm Password -->
        <div class="space-y-2">
          <Label for="change-confirm-password">Confirm New Password</Label>
          <Input
            id="change-confirm-password"
            v-model="confirmPassword"
            v-bind="confirmPasswordAttrs"
            type="password"
            placeholder="Re-enter new password"
            :disabled="authStore.isLoading"
            :class="{ 'border-destructive': errors.confirmPassword }"
          />
          <p v-if="errors.confirmPassword" class="text-sm text-destructive">
            {{ errors.confirmPassword }}
          </p>
        </div>

        <!-- Error display -->
        <div
          v-if="authStore.error"
          class="rounded-md border border-destructive/50 bg-destructive/10 p-3 text-sm text-destructive"
        >
          {{ authStore.error }}
        </div>

        <DialogFooter class="gap-2 sm:gap-0">
          <Button
            type="button"
            variant="outline"
            :disabled="authStore.isLoading"
            @click="closeDialog"
          >
            Cancel
          </Button>
          <Button
            type="submit"
            :disabled="authStore.isLoading"
          >
            <span v-if="authStore.isLoading" class="flex items-center gap-2">
              <span class="size-4 animate-spin rounded-full border-2 border-current border-t-transparent" />
              Changing...
            </span>
            <span v-else>Change Password</span>
          </Button>
        </DialogFooter>
      </form>
    </DialogContent>
  </Dialog>
</template>
```

**Verify:** `npm run build` passes. No Vuetify references in ChangePasswordModal.vue. The password complexity checklist renders with live check/circle icons.
</task>

<task id="5" depends_on="1">
### Task 5: Rewrite Login.vue standalone page (Card layout, same Zod schema as modal)

Rewrite `frontend/src/views/Login.vue` completely. Uses the same login Zod schema as LoginModal but renders in a centered Card layout instead of a Dialog. Preserves redirect-after-login behavior.

**Current behavior to preserve:**
- Centered card with logo, title, subtitle
- Username/password fields with required validation
- Show/hide password toggle
- "Remember me" checkbox (note: current code has this but does not persist it -- preserve the UI element)
- "Forgot Password?" link navigates to `/forgot-password`
- Error display from `authStore.error`
- Loading state
- On success, redirects to `route.query.redirect` or `/`
- If already authenticated on mount, redirects to `/`
- "Back to Home" link
- Info text about public database

**Complete replacement file:**

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { z } from 'zod'
import { toTypedSchema } from '@vee-validate/zod'
import { useForm } from 'vee-validate'
import { useAuthStore } from '@/stores/auth'
import { useRouter, useRoute, RouterLink } from 'vue-router'
import KidneyGeneticsLogo from '@/components/KidneyGeneticsLogo.vue'
import { Card, CardContent, CardFooter } from '@/components/ui/card'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Button } from '@/components/ui/button'
import { Eye, EyeOff, ArrowLeft } from 'lucide-vue-next'

const authStore = useAuthStore()
const router = useRouter()
const route = useRoute()

// Same Zod schema as LoginModal
const loginSchema = toTypedSchema(
  z.object({
    username: z.string().min(1, 'Username or email is required'),
    password: z.string().min(1, 'Password is required'),
  })
)

const { handleSubmit, defineField, errors } = useForm({
  validationSchema: loginSchema,
})

const [username, usernameAttrs] = defineField('username', {
  validateOnBlur: true,
  validateOnInput: true,
})
const [password, passwordAttrs] = defineField('password', {
  validateOnBlur: true,
  validateOnInput: true,
})

const showPassword = ref(false)
const rememberMe = ref(false)

const onSubmit = handleSubmit(async (values) => {
  const success = await authStore.login(values.username, values.password)

  if (success) {
    const redirectTo = (route.query.redirect as string) || '/'
    router.push(redirectTo)
  }
})

// If already authenticated, redirect home
onMounted(() => {
  if (authStore.isAuthenticated) {
    router.push('/')
  }
})
</script>

<template>
  <div class="flex min-h-[calc(100vh-8rem)] items-center justify-center px-4">
    <div class="w-full max-w-sm">
      <Card>
        <!-- Logo and Title -->
        <CardContent class="pt-8 pb-4 text-center">
          <div class="mb-4 flex items-center justify-center">
            <KidneyGeneticsLogo :size="64" variant="kidneys" :animated="false" />
          </div>
          <h1 class="mb-2 text-2xl font-medium">Welcome Back</h1>
          <p class="text-sm text-muted-foreground">
            Sign in to access curator and admin features
          </p>
        </CardContent>

        <!-- Login Form -->
        <CardContent class="px-6 pb-2">
          <form class="space-y-4" @submit.prevent="onSubmit">
            <div class="space-y-2">
              <Label for="page-login-username">Username or Email</Label>
              <Input
                id="page-login-username"
                v-model="username"
                v-bind="usernameAttrs"
                type="text"
                placeholder="Enter username or email"
                :disabled="authStore.isLoading"
                autofocus
                :class="{ 'border-destructive': errors.username }"
              />
              <p v-if="errors.username" class="text-sm text-destructive">
                {{ errors.username }}
              </p>
            </div>

            <div class="space-y-2">
              <Label for="page-login-password">Password</Label>
              <div class="relative">
                <Input
                  id="page-login-password"
                  v-model="password"
                  v-bind="passwordAttrs"
                  :type="showPassword ? 'text' : 'password'"
                  placeholder="Enter password"
                  :disabled="authStore.isLoading"
                  class="pr-10"
                  :class="{ 'border-destructive': errors.password }"
                  @keyup.enter="onSubmit"
                />
                <Button
                  type="button"
                  variant="ghost"
                  size="icon"
                  class="absolute right-0 top-0 h-full px-3 hover:bg-transparent"
                  :disabled="authStore.isLoading"
                  @click="showPassword = !showPassword"
                >
                  <EyeOff v-if="showPassword" class="size-4 text-muted-foreground" />
                  <Eye v-else class="size-4 text-muted-foreground" />
                </Button>
              </div>
              <p v-if="errors.password" class="text-sm text-destructive">
                {{ errors.password }}
              </p>
            </div>

            <div class="flex items-center justify-between">
              <label class="flex items-center gap-2 text-sm">
                <input
                  v-model="rememberMe"
                  type="checkbox"
                  class="size-4 rounded border-input"
                />
                Remember me
              </label>
              <RouterLink
                to="/forgot-password"
                class="text-sm text-primary hover:underline"
              >
                Forgot Password?
              </RouterLink>
            </div>

            <div
              v-if="authStore.error"
              class="rounded-md border border-destructive/50 bg-destructive/10 p-3 text-sm text-destructive"
            >
              {{ authStore.error }}
            </div>

            <Button
              type="submit"
              class="w-full"
              size="lg"
              :disabled="authStore.isLoading"
            >
              <span v-if="authStore.isLoading" class="flex items-center gap-2">
                <span class="size-4 animate-spin rounded-full border-2 border-current border-t-transparent" />
                Signing in...
              </span>
              <span v-else>Sign In</span>
            </Button>
          </form>
        </CardContent>

        <!-- Footer -->
        <CardFooter class="justify-center pb-6 pt-0">
          <RouterLink
            to="/"
            class="inline-flex items-center gap-1 text-sm text-muted-foreground hover:text-foreground"
          >
            <ArrowLeft class="size-4" />
            Back to Home
          </RouterLink>
        </CardFooter>
      </Card>

      <!-- Info text -->
      <p class="mt-6 text-center text-xs text-muted-foreground">
        This is a public database. Authentication is only required for data
        curation and administration.
      </p>
    </div>
  </div>
</template>
```

**Verify:** `npm run build` passes. No Vuetify references in Login.vue. Page renders centered with Card, form validates with Zod, redirect works on success.
</task>

<task id="6" depends_on="1">
### Task 6: Rewrite ForgotPassword.vue standalone page (Card layout, same schema as modal)

Rewrite `frontend/src/views/ForgotPassword.vue` completely. Uses the same Zod email schema as ForgotPasswordModal in a centered Card layout.

**Current behavior to preserve:**
- Centered card with logo, title, subtitle
- Email field with required + email validation
- Calls `authStore.requestPasswordReset(email)`
- Shows success message, then redirects to `/login` after 3 seconds
- Shows `authStore.error` on failure
- Loading state
- "Back to Login" link

**Complete replacement file:**

```vue
<script setup lang="ts">
import { ref } from 'vue'
import { z } from 'zod'
import { toTypedSchema } from '@vee-validate/zod'
import { useForm } from 'vee-validate'
import { useAuthStore } from '@/stores/auth'
import { useRouter, RouterLink } from 'vue-router'
import KidneyGeneticsLogo from '@/components/KidneyGeneticsLogo.vue'
import { Card, CardContent, CardFooter } from '@/components/ui/card'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Button } from '@/components/ui/button'
import { ArrowLeft } from 'lucide-vue-next'

const authStore = useAuthStore()
const router = useRouter()

// Same Zod schema as ForgotPasswordModal
const forgotPasswordSchema = toTypedSchema(
  z.object({
    email: z
      .string()
      .min(1, 'Email is required')
      .email('Invalid email address'),
  })
)

const { handleSubmit, defineField, errors } = useForm({
  validationSchema: forgotPasswordSchema,
})

const [email, emailAttrs] = defineField('email', {
  validateOnBlur: true,
  validateOnInput: true,
})

const submitted = ref(false)

const onSubmit = handleSubmit(async (values) => {
  const success = await authStore.requestPasswordReset(values.email)

  if (success) {
    submitted.value = true
    setTimeout(() => {
      router.push('/login')
    }, 3000)
  }
})
</script>

<template>
  <div class="flex min-h-[calc(100vh-8rem)] items-center justify-center px-4">
    <div class="w-full max-w-sm">
      <Card>
        <!-- Logo and Title -->
        <CardContent class="pt-8 pb-4 text-center">
          <div class="mb-4 flex items-center justify-center">
            <KidneyGeneticsLogo :size="64" variant="kidneys" :animated="false" />
          </div>
          <h1 class="mb-2 text-2xl font-medium">Reset Password</h1>
          <p class="text-sm text-muted-foreground">
            Enter your email address and we'll send you instructions to reset
            your password
          </p>
        </CardContent>

        <!-- Reset Form -->
        <CardContent class="px-6 pb-2">
          <form class="space-y-4" @submit.prevent="onSubmit">
            <div class="space-y-2">
              <Label for="page-forgot-email">Email Address</Label>
              <Input
                id="page-forgot-email"
                v-model="email"
                v-bind="emailAttrs"
                type="email"
                placeholder="Enter your email"
                :disabled="authStore.isLoading || submitted"
                autofocus
                :class="{ 'border-destructive': errors.email }"
              />
              <p v-if="errors.email" class="text-sm text-destructive">
                {{ errors.email }}
              </p>
            </div>

            <div
              v-if="submitted"
              class="rounded-md border border-green-500/50 bg-green-500/10 p-3 text-sm text-green-700 dark:text-green-400"
            >
              Password reset instructions have been sent to your email.
            </div>

            <div
              v-if="authStore.error"
              class="rounded-md border border-destructive/50 bg-destructive/10 p-3 text-sm text-destructive"
            >
              {{ authStore.error }}
            </div>

            <Button
              type="submit"
              class="w-full"
              size="lg"
              :disabled="authStore.isLoading || submitted"
            >
              <span v-if="authStore.isLoading" class="flex items-center gap-2">
                <span class="size-4 animate-spin rounded-full border-2 border-current border-t-transparent" />
                Sending...
              </span>
              <span v-else>Send Reset Email</span>
            </Button>
          </form>
        </CardContent>

        <!-- Footer -->
        <CardFooter class="justify-center pb-6 pt-0">
          <RouterLink
            to="/login"
            class="inline-flex items-center gap-1 text-sm text-muted-foreground hover:text-foreground"
          >
            <ArrowLeft class="size-4" />
            Back to Login
          </RouterLink>
        </CardFooter>
      </Card>
    </div>
  </div>
</template>
```

**Verify:** `npm run build` passes. No Vuetify references in ForgotPassword.vue. Page renders centered with Card, email validates with Zod.
</task>

<task id="7" depends_on="1,2,3,4,5,6">
### Task 7: Verify build + lint + zero Vuetify references in auth files

Run the full verification suite to confirm all auth files are clean.

```bash
cd /home/bernt-popp/development/kidney-genetics-db/frontend

# Build must pass
npm run build

# Lint must pass
npm run lint

# Zero Vuetify component references in auth files
grep -E 'v-dialog|v-form|v-text-field|v-card|v-alert|v-btn|v-icon|v-spacer|v-container|v-row|v-col|v-checkbox' \
  src/components/auth/LoginModal.vue \
  src/components/auth/ForgotPasswordModal.vue \
  src/components/auth/ChangePasswordModal.vue \
  src/views/Login.vue \
  src/views/ForgotPassword.vue
# Expected: no output (zero matches)

# Confirm all files use TypeScript
grep 'lang="ts"' \
  src/components/auth/LoginModal.vue \
  src/components/auth/ForgotPasswordModal.vue \
  src/components/auth/ChangePasswordModal.vue \
  src/views/Login.vue \
  src/views/ForgotPassword.vue
# Expected: all 5 files match

# Confirm vee-validate + Zod usage
grep 'toTypedSchema' \
  src/components/auth/LoginModal.vue \
  src/components/auth/ForgotPasswordModal.vue \
  src/components/auth/ChangePasswordModal.vue \
  src/views/Login.vue \
  src/views/ForgotPassword.vue
# Expected: all 5 files match

# Confirm LoginModal is wired in AppHeader
grep 'LoginModal' src/layouts/AppHeader.vue
# Expected: import + template usage
grep 'login-success' src/layouts/AppHeader.vue
# Expected: @login-success handler

# Confirm no router.go(0) in any auth file
grep 'router.go' \
  src/components/auth/LoginModal.vue \
  src/views/Login.vue
# Expected: no output (zero matches)
```

Fix any lint errors or type errors before marking this plan complete.
</task>

## Verification

- [ ] `npm run build` succeeds with zero errors
- [ ] `npm run lint` passes
- [ ] LoginModal.vue uses Dialog + vee-validate + Zod (no Vuetify components)
- [ ] LoginModal.vue uses v-model:open pattern (no embedded activator)
- [ ] LoginModal.vue emits `login-success` (no `router.go(0)`)
- [ ] ForgotPasswordModal.vue uses Dialog + vee-validate + Zod
- [ ] ChangePasswordModal.vue uses Dialog + vee-validate + Zod
- [ ] ChangePasswordModal.vue shows 5 password requirements as live checklist with Check/Circle icons
- [ ] Login.vue standalone page uses Card layout with same Zod login schema
- [ ] ForgotPassword.vue standalone page uses Card layout with same Zod email schema
- [ ] AppHeader.vue imports LoginModal with v-model:open and handles @login-success with toast
- [ ] All 5 auth files have `<script setup lang="ts">`
- [ ] All 5 auth files use `toTypedSchema` from `@vee-validate/zod`
- [ ] All `defineField()` calls use `validateOnBlur: true` and `validateOnInput: true`
- [ ] Zero `v-dialog`, `v-form`, `v-text-field`, `v-card`, `v-alert` references in any auth file
- [ ] Zero `router.go(0)` calls in any auth file

## must_haves

- LoginModal.vue is controlled via v-model:open from parent (no embedded activator button)
- Login success emits event to parent, parent shows toast, NO router.go(0)
- All Zod schemas are top-level static const, NOT inside computed()
- All defineField() calls use validateOnBlur: true + validateOnInput: true
- ChangePasswordModal shows 5-item password complexity checklist with live Check/Circle icons
- Standalone Login.vue and ForgotPassword.vue use Card layout with same Zod schemas as modals
- AppHeader.vue wires LoginModal via v-model:open and handles @login-success with vue-sonner toast
- Zero Vuetify component references in all 5 auth files after migration
- All 5 auth files use lang="ts" TypeScript script setup
