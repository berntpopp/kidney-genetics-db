---
phase: 02-typescript-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/types/evidence.ts
  - frontend/src/types/log.ts
  - frontend/src/types/gene.ts
  - frontend/src/types/index.ts
  - frontend/env.d.ts
  - frontend/src/utils/debounce.ts
  - frontend/src/utils/wildcardMatcher.ts
  - frontend/src/utils/stateCompression.ts
  - frontend/src/utils/formatters.ts
  - frontend/src/utils/adminBreadcrumbs.ts
  - frontend/src/utils/adminIcons.ts
  - frontend/src/utils/publicBreadcrumbs.ts
  - frontend/src/utils/logSanitizer.ts
  - frontend/src/utils/evidenceTiers.ts
  - frontend/src/utils/networkStateCodec.ts
  - frontend/src/utils/version.ts
  - frontend/src/config.ts
  - frontend/src/config/networkAnalysis.ts
  - frontend/src/plugins/vuetify.ts
autonomous: true

must_haves:
  truths:
    - "All 11 utility files, 2 config files, and vuetify plugin exist as .ts with typed exports"
    - "Evidence source types provide per-source interfaces for ClinGen, GenCC, HPO, PanelApp, PubTator, DiagnosticPanels, Literature"
    - "Window augmentations (logService, _env_, snackbar) and ImportMetaEnv (VITE_API_URL, VITE_WS_URL) are declared in env.d.ts"
    - "npm run build succeeds with zero errors after all renames"
  artifacts:
    - path: "frontend/src/types/evidence.ts"
      provides: "Per-source evidence data interfaces and AnnotationSourceName union type"
      exports: ["ClinGenEvidenceData", "GenCCEvidenceData", "HPOEvidenceData", "PanelAppEvidenceData", "PubTatorEvidenceData", "DiagnosticPanelsEvidenceData", "LiteratureEvidenceData", "EvidenceData", "AnnotationSourceName"]
    - path: "frontend/src/types/log.ts"
      provides: "LogEntry and LogLevel types for store and service typing"
      exports: ["LogEntry", "LogLevel"]
    - path: "frontend/env.d.ts"
      provides: "Window and ImportMetaEnv augmentations"
      contains: "interface Window"
    - path: "frontend/src/utils/debounce.ts"
      provides: "Typed debounce with DebouncedFunction<T> generic"
      exports: ["debounce", "throttle", "DebouncedFunction"]
  key_links:
    - from: "frontend/src/types/evidence.ts"
      to: "frontend/src/types/gene.ts"
      via: "EvidenceSource.source_data typed as EvidenceData"
      pattern: "source_data: EvidenceData"
    - from: "frontend/env.d.ts"
      to: "all files using window.logService, window._env_, window.snackbar"
      via: "Window interface augmentation"
      pattern: "interface Window"
---

<objective>
Migrate all Tier 1 and Tier 2 dependency files to TypeScript: create evidence/log type definitions, add Window augmentations to env.d.ts, and rename all 11 utility files + 2 config files + vuetify plugin from .js to .ts with full type annotations.

Purpose: These files have zero project import dependencies and form the foundation that all API modules, services, stores, and composables depend on. Migrating them first prevents circular dependency issues and makes typed imports available to everything migrated in Plans 02 and 03.

Output: 17 renamed/created .ts files with typed exports, updated env.d.ts, updated gene.ts with typed EvidenceData.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-typescript-migration/02-RESEARCH.md
@.planning/phases/02-typescript-migration/02-CONTEXT.md
@.planning/phases/01-foundation-setup/01-01-SUMMARY.md

Key references:
- `frontend/src/types/gene.ts` — EvidenceSource.source_data currently `Record<string, unknown>`, must become `EvidenceData`
- `frontend/env.d.ts` — needs Window augmentations for logService, _env_, snackbar
- `frontend/tsconfig.app.json` — strict: true, allowJs: true, checkJs: false, verbatimModuleSyntax: true
- All utility files in `frontend/src/utils/*.js` — 11 files to migrate
- `frontend/src/config.js` and `frontend/src/config/networkAnalysis.js` — 2 config files
- `frontend/src/plugins/vuetify.js` — vuetify plugin
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create evidence and log type definitions, update env.d.ts with Window augmentations</name>
  <files>
    frontend/src/types/evidence.ts
    frontend/src/types/log.ts
    frontend/src/types/gene.ts
    frontend/src/types/index.ts
    frontend/env.d.ts
  </files>
  <action>
  **1. Create `src/types/evidence.ts`** with per-source typed interfaces:

  - `ClinGenEvidenceData` — keys: validity_count (number), validities (ClinGenValidity[]), diseases (string[]), classifications (string[]), expert_panels (string[]), modes_of_inheritance (string[]), max_classification_score (number), evidence_score (number), last_updated (string)
  - Define `ClinGenValidity` as `{ disease: string; classification: string; moi: string; panel: string }` or similar based on what the frontend actually reads
  - `GenCCEvidenceData` — keys: submission_count (number), submissions (GenCCSubmission[]), diseases (string[]), classifications (string[]), submitters (string[]), modes_of_inheritance (string[]), evidence_score (number)
  - `HPOEvidenceData` — keys: hpo_terms (string[]), term_count? (number), evidence_score (number)
  - `PanelAppEvidenceData` — keys: panel_count (number), panels (string[]), regions (string[]), phenotypes (string[]), modes_of_inheritance (string[]), evidence_levels (string[]), last_updated (string)
  - `PubTatorEvidenceData` — keys: pmids (string[]), publication_count (number), total_mentions (number), evidence_score (number)
  - `DiagnosticPanelsEvidenceData` — keys: panels (string[]), providers (string[]), panel_count (number), provider_count (number)
  - `LiteratureEvidenceData` — keys: publications (string[]), publication_count (number), publication_details? (Record<string, unknown>)
  - `AnnotationSourceName` type = union of the 7 source name string literals
  - `EvidenceData` type = union of all 7 interfaces | Record<string, unknown> (fallback for HGNC/gnomAD/GTEx)
  - Use `export type` and `export interface` (verbatimModuleSyntax compliance)
  - For nested arrays (validities, submissions), use `Record<string, unknown>[]` if the frontend doesn't destructure their fields — Claude's discretion on depth

  **2. Create `src/types/log.ts`** with:
  - `LogLevel` type = `'DEBUG' | 'INFO' | 'WARN' | 'ERROR' | 'CRITICAL'`
  - `LogEntry` interface — keys: timestamp (string), level (LogLevel), message (string), data? (unknown), correlationId? (string | null), metadata? (Record<string, unknown>), url? (string), userAgent? (string)

  **3. Update `src/types/gene.ts`:**
  - Import `EvidenceData` from `./evidence` using `import type`
  - Change `EvidenceSource.source_data` from `Record<string, unknown>` to `EvidenceData`

  **4. Update `src/types/index.ts`:**
  - Add barrel re-exports for evidence.ts and log.ts

  **5. Update `env.d.ts`:**
  - Add `Window` interface augmentation with:
    - `logService: import('@/services/logService').LogService` (Note: LogService class doesn't exist as a type export yet — use inline typeof or define a minimal interface. Since logService.ts hasn't been migrated yet, declare Window.logService as a minimal interface matching the public API: `{ debug, info, warn, error, critical, logPerformance, logApiCall, initStore, setCorrelationId, clearCorrelationId, setMetadata, clearMetadata, setConsoleEcho, setMaxEntries, setMinLogLevel, clearLogs, exportLogs }` with appropriate signatures. This will be refined when logService.ts is migrated in Plan 02.)
    - `_env_?: { API_BASE_URL?: string; WS_URL?: string; ENVIRONMENT?: string; VERSION?: string }`
    - `snackbar?: { success(msg: string, opts?: Record<string, unknown>): void; error(msg: string, opts?: Record<string, unknown>): void }`
  - Add missing `ImportMetaEnv` entries: `VITE_API_URL?: string`, `VITE_WS_URL?: string`
  </action>
  <verify>
  Run `cd frontend && npx vue-tsc --noEmit --project tsconfig.app.json 2>&1 | head -20` — should show no errors related to new type files.
  Run `cd frontend && npm run build` — should exit 0.
  Verify new files exist: `ls -la src/types/evidence.ts src/types/log.ts`
  </verify>
  <done>
  - evidence.ts exports 7 per-source interfaces + EvidenceData union + AnnotationSourceName
  - log.ts exports LogEntry interface + LogLevel type
  - gene.ts EvidenceSource.source_data is typed as EvidenceData (not Record<string, unknown>)
  - env.d.ts has Window augmentation (logService, _env_, snackbar) and extended ImportMetaEnv
  - index.ts re-exports all new types
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate all utilities, config files, and vuetify plugin to TypeScript</name>
  <files>
    frontend/src/utils/debounce.ts
    frontend/src/utils/wildcardMatcher.ts
    frontend/src/utils/stateCompression.ts
    frontend/src/utils/formatters.ts
    frontend/src/utils/adminBreadcrumbs.ts
    frontend/src/utils/adminIcons.ts
    frontend/src/utils/publicBreadcrumbs.ts
    frontend/src/utils/logSanitizer.ts
    frontend/src/utils/evidenceTiers.ts
    frontend/src/utils/networkStateCodec.ts
    frontend/src/utils/version.ts
    frontend/src/config.ts
    frontend/src/config/networkAnalysis.ts
    frontend/src/plugins/vuetify.ts
  </files>
  <action>
  Migrate 14 files from .js to .ts using `git mv` for each file to preserve commit history. Add type annotations to all exports.

  **Migration order** (dependency-safe):
  1. Files with ZERO project imports (Tier 1) — migrate in any order:
     - `src/utils/debounce.js` -> `.ts` — Add generic `DebouncedFunction<T>` interface with `cancel(): void` and `flush(...args: Parameters<T>): void`. Type `debounce<T extends (...args: any[]) => any>(fn: T, delay: number): DebouncedFunction<T>`. Type `throttle` similarly.
     - `src/utils/wildcardMatcher.js` -> `.ts` — Type validation result interfaces and pure function signatures.
     - `src/utils/stateCompression.js` -> `.ts` — Type compress/decompress function signatures (string -> string | null). Uses `window.logService` — the Window augmentation from Task 1 covers this.
     - `src/utils/formatters.js` -> `.ts` — Type 3 pure formatting functions with string/number params and string returns.
     - `src/utils/adminBreadcrumbs.js` -> `.ts` — Type breadcrumb item interface `{ title: string; to?: string; disabled?: boolean }` and function returns.
     - `src/utils/adminIcons.js` -> `.ts` — Type the icon mapping as `Record<string, string>` or typed constants.
     - `src/utils/publicBreadcrumbs.js` -> `.ts` — Same breadcrumb pattern as adminBreadcrumbs.
     - `src/utils/logSanitizer.js` -> `.ts` — Type sanitize functions. Import `LogEntry` type from `@/types/log`. Type the `_testing` export for test access.
     - `src/utils/evidenceTiers.js` -> `.ts` — Create `TierName` union literal type (`'comprehensive_support' | 'multi_source_support' | ...`). Type TIER_CONFIG, GROUP_CONFIG, SCORE_RANGES with proper interfaces. Type getTierConfig, getGroupConfig, getTierSortOrder, getScoreRangeConfig, getScoreExplanation.
     - `src/config/networkAnalysis.js` -> `.ts` — Type the network analysis config object with interface.
     - `src/config.js` -> `.ts` — Type the config object. Uses `window._env_` which is now typed from env.d.ts.

  2. Files depending on Tier 1 (Tier 2):
     - `src/utils/networkStateCodec.js` -> `.ts` — Imports from stateCompression (now .ts). Type encode/decode functions. Fix `window.logService.warning()` to `window.logService.warn()` (the `warning` method does NOT exist — this is a known bug that will surface as a TS error).
     - `src/utils/version.js` -> `.ts` — Uses `__APP_VERSION__` global (already in env.d.ts). Type the async version check function.
     - `src/plugins/vuetify.js` -> `.ts` — `createVuetify()` is already typed by Vuetify. Just add explicit return type annotation.

  **For each file:**
  1. `git mv src/utils/foo.js src/utils/foo.ts` (preserves history)
  2. Add type annotations to all function parameters and return values
  3. Add typed interfaces for complex objects (configs, result shapes)
  4. Use `import type` for type-only imports (verbatimModuleSyntax)
  5. Ensure all exports use named exports (not default, except where existing API requires it)

  **Critical: Fix the logService.warning() bug in networkStateCodec.ts.** The method is `warn()`, not `warning()`. This is documented in 02-RESEARCH.md Pitfall 6.

  **Do NOT change the default export pattern** for files that currently use `export default` (like debounce.js which exports `{ debounce, throttle }` as default). Keep backward compatibility with existing consumers.
  </action>
  <verify>
  Run `cd frontend && npm run build` — must exit 0.
  Run `cd frontend && npx vue-tsc --noEmit --project tsconfig.app.json 2>&1 | head -30` — no errors from migrated files.
  Verify no .js files remain for migrated utilities: `ls frontend/src/utils/*.js 2>/dev/null` should return nothing.
  Verify renames preserved git history: `git log --follow --oneline -3 frontend/src/utils/debounce.ts`
  </verify>
  <done>
  - All 11 utility .js files renamed to .ts with full type annotations
  - Both config .js files renamed to .ts with typed config objects
  - vuetify.js renamed to vuetify.ts
  - DebouncedFunction<T> generic interface exported from debounce.ts
  - TierName union type and typed TIER_CONFIG exported from evidenceTiers.ts
  - networkStateCodec.ts uses warn() not warning() (bug fixed)
  - npm run build and vue-tsc pass with zero errors
  - No .js files remain in src/utils/, src/config/, src/plugins/
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npm run build` exits 0 — application still builds
2. `cd frontend && npx vue-tsc --noEmit` — zero type errors from migrated files
3. `cd frontend && npm run dev` — application loads and functions (no visual changes)
4. `ls frontend/src/utils/*.js frontend/src/config/*.js frontend/src/plugins/*.js 2>/dev/null` returns empty — all .js files migrated
5. `grep -r "window.logService.warning" frontend/src/` returns zero results — bug fixed
</verification>

<success_criteria>
- 17 files migrated from .js to .ts (11 utils + 2 config + 1 plugin + evidence.ts + log.ts + env.d.ts update)
- EvidenceSource.source_data typed as EvidenceData union (not Record<string, unknown>)
- Window augmentations enable type-safe access to window.logService, window._env_, window.snackbar
- DebouncedFunction<T> generic enables typed debounce usage in composables
- Zero regressions: npm run build exits 0, application functions identically
</success_criteria>

<output>
After completion, create `.planning/phases/02-typescript-migration/02-01-SUMMARY.md`
</output>
