---
phase: "06"
plan: "06-01"
title: "DataTable infrastructure (TanStack Table + shadcn-vue)"
wave: 1
depends_on: ["04-01"]
files_modified: []
files_created:
  - "frontend/src/components/ui/data-table/DataTable.vue"
  - "frontend/src/components/ui/data-table/DataTableColumnHeader.vue"
  - "frontend/src/components/ui/data-table/DataTablePagination.vue"
  - "frontend/src/components/ui/data-table/DataTableViewOptions.vue"
  - "frontend/src/components/ui/data-table/DataTableFacetedFilter.vue"
  - "frontend/src/components/ui/data-table/index.ts"
autonomous: true
estimated_minutes: 50
requirements:
  - "TABLE-01: DataTable wraps @tanstack/vue-table with shadcn-vue Table primitives"
  - "TABLE-02: Supports both server-side and client-side pagination"
  - "TABLE-03: Column header supports sortable indicators"
  - "TABLE-04: Pagination component with page size selector"
  - "TABLE-05: Column visibility toggle"
  - "TABLE-06: Faceted filter for categorical columns"

must_haves:
  truths:
    - "shadcn-vue table, select, slider, pagination, checkbox components are installed"
    - "@tanstack/vue-table is available in dependencies"
    - "DataTable renders a basic table with column headers"
    - "DataTablePagination shows page controls and size selector"
    - "DataTableColumnHeader shows sort direction indicators"
    - "`npm run build` succeeds"
    - "`npm run lint` has 0 errors"
  artifacts:
    - path: "frontend/src/components/ui/data-table/DataTable.vue"
      provides: "Generic table wrapper with TanStack Table integration"
    - path: "frontend/src/components/ui/data-table/DataTablePagination.vue"
      provides: "Pagination with page size selector and page navigation"
    - path: "frontend/src/components/ui/data-table/index.ts"
      provides: "Barrel export for all data table components"

---

# 06-01: DataTable Infrastructure

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Create a reusable DataTable component system built on @tanstack/vue-table and shadcn-vue Table primitives. This infrastructure is used by GeneTable, EnrichmentTable, and all admin data tables.

**Architecture:** Composable TanStack Table wrapper with pluggable column headers, pagination, and filters. Supports both `manualPagination: true` (server-side) and automatic (client-side) modes.

**Reference:** [shadcn-vue data-table docs](https://www.shadcn-vue.com/docs/components/data-table), [TanStack Table Vue](https://tanstack.com/table/v8/docs/framework/vue)

---

<task id="1">
### Task 1: Install shadcn-vue components for data tables

```bash
cd frontend
npx shadcn-vue@latest add table select slider pagination checkbox command
```

Verify @tanstack/vue-table is installed:
```bash
npm ls @tanstack/vue-table
```
If not installed: `npm install @tanstack/vue-table`

**Commit:**
```bash
git add frontend/src/components/ui/table/ frontend/src/components/ui/select/ \
  frontend/src/components/ui/slider/ frontend/src/components/ui/pagination/ \
  frontend/src/components/ui/checkbox/ frontend/src/components/ui/command/
git commit -m "feat(06-01): install shadcn-vue table, select, slider, pagination, checkbox, command"
```
</task>

<task id="2" depends_on="1">
### Task 2: Create DataTable.vue

**Create:** `frontend/src/components/ui/data-table/DataTable.vue`

This is the core wrapper. It accepts a TanStack table instance and renders it with shadcn-vue Table primitives.

```vue
<script setup lang="ts" generic="TData">
import type { Table } from '@tanstack/vue-table'
import { FlexRender } from '@tanstack/vue-table'
import {
  Table as UiTable,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table'

interface Props {
  table: Table<TData>
}

defineProps<Props>()
</script>

<template>
  <div class="rounded-md border">
    <UiTable>
      <TableHeader>
        <TableRow v-for="headerGroup in table.getHeaderGroups()" :key="headerGroup.id">
          <TableHead v-for="header in headerGroup.headers" :key="header.id" :style="{ width: header.getSize() !== 150 ? `${header.getSize()}px` : undefined }">
            <FlexRender
              v-if="!header.isPlaceholder"
              :render="header.column.columnDef.header"
              :props="header.getContext()"
            />
          </TableHead>
        </TableRow>
      </TableHeader>
      <TableBody>
        <template v-if="table.getRowModel().rows?.length">
          <TableRow
            v-for="row in table.getRowModel().rows"
            :key="row.id"
            :data-state="row.getIsSelected() ? 'selected' : undefined"
          >
            <TableCell v-for="cell in row.getVisibleCells()" :key="cell.id">
              <FlexRender :render="cell.column.columnDef.cell" :props="cell.getContext()" />
            </TableCell>
          </TableRow>
        </template>
        <template v-else>
          <TableRow>
            <TableCell :colspan="table.getAllColumns().length" class="h-24 text-center text-muted-foreground">
              No results.
            </TableCell>
          </TableRow>
        </template>
      </TableBody>
    </UiTable>
  </div>
</template>
```

**Commit:**
```bash
git add frontend/src/components/ui/data-table/DataTable.vue
git commit -m "feat(06-01): create DataTable wrapper component"
```
</task>

<task id="3" depends_on="1">
### Task 3: Create DataTableColumnHeader.vue

**Create:** `frontend/src/components/ui/data-table/DataTableColumnHeader.vue`

Sortable column header with direction indicators.

```vue
<script setup lang="ts">
import type { Column } from '@tanstack/vue-table'
import { ArrowDown, ArrowUp, ArrowUpDown, EyeOff } from 'lucide-vue-next'
import { Button } from '@/components/ui/button'
import {
  DropdownMenu, DropdownMenuContent, DropdownMenuItem,
  DropdownMenuSeparator, DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'
import { cn } from '@/lib/utils'

interface Props {
  column: Column<any, any>
  title: string
}

defineProps<Props>()
</script>

<template>
  <div v-if="!column.getCanSort()" :class="cn('flex items-center space-x-2', $attrs.class ?? '')">
    {{ title }}
  </div>
  <DropdownMenu v-else>
    <DropdownMenuTrigger as-child>
      <Button variant="ghost" size="sm" class="-ml-3 h-8 data-[state=open]:bg-accent">
        <span>{{ title }}</span>
        <ArrowDown v-if="column.getIsSorted() === 'desc'" class="ml-2 h-4 w-4" />
        <ArrowUp v-else-if="column.getIsSorted() === 'asc'" class="ml-2 h-4 w-4" />
        <ArrowUpDown v-else class="ml-2 h-4 w-4" />
      </Button>
    </DropdownMenuTrigger>
    <DropdownMenuContent align="start">
      <DropdownMenuItem @click="column.toggleSorting(false)">
        <ArrowUp class="mr-2 h-3.5 w-3.5 text-muted-foreground/70" />
        Asc
      </DropdownMenuItem>
      <DropdownMenuItem @click="column.toggleSorting(true)">
        <ArrowDown class="mr-2 h-3.5 w-3.5 text-muted-foreground/70" />
        Desc
      </DropdownMenuItem>
      <DropdownMenuSeparator />
      <DropdownMenuItem @click="column.toggleVisibility(false)">
        <EyeOff class="mr-2 h-3.5 w-3.5 text-muted-foreground/70" />
        Hide
      </DropdownMenuItem>
    </DropdownMenuContent>
  </DropdownMenu>
</template>
```

**Commit:**
```bash
git add frontend/src/components/ui/data-table/DataTableColumnHeader.vue
git commit -m "feat(06-01): create DataTableColumnHeader with sort indicators"
```
</task>

<task id="4" depends_on="1">
### Task 4: Create DataTablePagination.vue

**Create:** `frontend/src/components/ui/data-table/DataTablePagination.vue`

Pagination with page size selector and navigation buttons.

```vue
<script setup lang="ts">
import type { Table } from '@tanstack/vue-table'
import { ChevronLeft, ChevronRight, ChevronsLeft, ChevronsRight } from 'lucide-vue-next'
import { Button } from '@/components/ui/button'
import {
  Select, SelectContent, SelectItem, SelectTrigger, SelectValue,
} from '@/components/ui/select'

interface Props {
  table: Table<any>
  pageSizeOptions?: number[]
}

const props = withDefaults(defineProps<Props>(), {
  pageSizeOptions: () => [10, 20, 30, 50, 100],
})
</script>

<template>
  <div class="flex items-center justify-between px-2 py-4">
    <!-- Row count info -->
    <div class="flex-1 text-sm text-muted-foreground">
      {{ table.getFilteredRowModel().rows.length }} row(s) total
    </div>
    <div class="flex items-center space-x-6 lg:space-x-8">
      <!-- Page size selector -->
      <div class="flex items-center space-x-2">
        <p class="text-sm font-medium">Rows per page</p>
        <Select
          :model-value="`${table.getState().pagination.pageSize}`"
          @update:model-value="(val) => table.setPageSize(Number(val))"
        >
          <SelectTrigger class="h-8 w-[70px]">
            <SelectValue :placeholder="`${table.getState().pagination.pageSize}`" />
          </SelectTrigger>
          <SelectContent side="top">
            <SelectItem v-for="size in pageSizeOptions" :key="size" :value="`${size}`">
              {{ size }}
            </SelectItem>
          </SelectContent>
        </Select>
      </div>
      <!-- Page indicator -->
      <div class="flex w-[100px] items-center justify-center text-sm font-medium">
        Page {{ table.getState().pagination.pageIndex + 1 }} of {{ table.getPageCount() }}
      </div>
      <!-- Navigation buttons -->
      <div class="flex items-center space-x-2">
        <Button variant="outline" class="hidden h-8 w-8 p-0 lg:flex" :disabled="!table.getCanPreviousPage()" @click="table.setPageIndex(0)">
          <ChevronsLeft class="h-4 w-4" />
        </Button>
        <Button variant="outline" class="h-8 w-8 p-0" :disabled="!table.getCanPreviousPage()" @click="table.previousPage()">
          <ChevronLeft class="h-4 w-4" />
        </Button>
        <Button variant="outline" class="h-8 w-8 p-0" :disabled="!table.getCanNextPage()" @click="table.nextPage()">
          <ChevronRight class="h-4 w-4" />
        </Button>
        <Button variant="outline" class="hidden h-8 w-8 p-0 lg:flex" :disabled="!table.getCanNextPage()" @click="table.setPageIndex(table.getPageCount() - 1)">
          <ChevronsRight class="h-4 w-4" />
        </Button>
      </div>
    </div>
  </div>
</template>
```

**Commit:**
```bash
git add frontend/src/components/ui/data-table/DataTablePagination.vue
git commit -m "feat(06-01): create DataTablePagination with page size selector"
```
</task>

<task id="5" depends_on="1">
### Task 5: Create DataTableViewOptions.vue + DataTableFacetedFilter.vue + index.ts

**Create:** `frontend/src/components/ui/data-table/DataTableViewOptions.vue`

Column visibility toggle dropdown.

```vue
<script setup lang="ts">
import type { Table } from '@tanstack/vue-table'
import { Settings2 } from 'lucide-vue-next'
import { Button } from '@/components/ui/button'
import {
  DropdownMenu, DropdownMenuCheckboxItem, DropdownMenuContent,
  DropdownMenuLabel, DropdownMenuSeparator, DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'

interface Props {
  table: Table<any>
}

defineProps<Props>()
</script>

<template>
  <DropdownMenu>
    <DropdownMenuTrigger as-child>
      <Button variant="outline" size="sm" class="ml-auto hidden h-8 lg:flex">
        <Settings2 class="mr-2 h-4 w-4" />
        View
      </Button>
    </DropdownMenuTrigger>
    <DropdownMenuContent align="end" class="w-[150px]">
      <DropdownMenuLabel>Toggle columns</DropdownMenuLabel>
      <DropdownMenuSeparator />
      <DropdownMenuCheckboxItem
        v-for="column in table.getAllColumns().filter(c => c.getCanHide())"
        :key="column.id"
        :checked="column.getIsVisible()"
        @update:checked="(val) => column.toggleVisibility(!!val)"
      >
        {{ column.id }}
      </DropdownMenuCheckboxItem>
    </DropdownMenuContent>
  </DropdownMenu>
</template>
```

**Create:** `frontend/src/components/ui/data-table/DataTableFacetedFilter.vue`

Faceted filter using Command (for categorical columns like source, tier).

```vue
<script setup lang="ts">
import type { Column } from '@tanstack/vue-table'
import { computed } from 'vue'
import { Check, PlusCircle } from 'lucide-vue-next'
import { Badge } from '@/components/ui/badge'
import { Button } from '@/components/ui/button'
import {
  Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList, CommandSeparator,
} from '@/components/ui/command'
import { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover'
import { Separator } from '@/components/ui/separator'
import { cn } from '@/lib/utils'

interface Props {
  column: Column<any, any>
  title: string
  options: { label: string; value: string; icon?: any }[]
}

const props = defineProps<Props>()
const selectedValues = computed(() => new Set(props.column.getFilterValue() as string[] ?? []))

function toggleOption(value: string) {
  const current = new Set(selectedValues.value)
  if (current.has(value)) {
    current.delete(value)
  } else {
    current.add(value)
  }
  const filterValues = Array.from(current)
  props.column.setFilterValue(filterValues.length ? filterValues : undefined)
}
</script>

<template>
  <Popover>
    <PopoverTrigger as-child>
      <Button variant="outline" size="sm" class="h-8 border-dashed">
        <PlusCircle class="mr-2 h-4 w-4" />
        {{ title }}
        <template v-if="selectedValues.size > 0">
          <Separator orientation="vertical" class="mx-2 h-4" />
          <Badge variant="secondary" class="rounded-sm px-1 font-normal lg:hidden">
            {{ selectedValues.size }}
          </Badge>
          <div class="hidden space-x-1 lg:flex">
            <Badge v-for="val in Array.from(selectedValues).slice(0, 2)" :key="val" variant="secondary" class="rounded-sm px-1 font-normal">
              {{ options.find(o => o.value === val)?.label ?? val }}
            </Badge>
            <Badge v-if="selectedValues.size > 2" variant="secondary" class="rounded-sm px-1 font-normal">
              +{{ selectedValues.size - 2 }}
            </Badge>
          </div>
        </template>
      </Button>
    </PopoverTrigger>
    <PopoverContent class="w-[200px] p-0" align="start">
      <Command>
        <CommandInput :placeholder="`Search ${title}...`" />
        <CommandList>
          <CommandEmpty>No results.</CommandEmpty>
          <CommandGroup>
            <CommandItem
              v-for="option in options"
              :key="option.value"
              :value="option.value"
              @select="toggleOption(option.value)"
            >
              <div :class="cn('mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary', selectedValues.has(option.value) ? 'bg-primary text-primary-foreground' : 'opacity-50 [&_svg]:invisible')">
                <Check class="h-4 w-4" />
              </div>
              <component :is="option.icon" v-if="option.icon" class="mr-2 h-4 w-4 text-muted-foreground" />
              <span>{{ option.label }}</span>
            </CommandItem>
          </CommandGroup>
          <template v-if="selectedValues.size > 0">
            <CommandSeparator />
            <CommandGroup>
              <CommandItem class="justify-center text-center" @select="column.setFilterValue(undefined)">
                Clear filters
              </CommandItem>
            </CommandGroup>
          </template>
        </CommandList>
      </Command>
    </PopoverContent>
  </Popover>
</template>
```

**Create:** `frontend/src/components/ui/data-table/index.ts`

```typescript
export { default as DataTable } from './DataTable.vue'
export { default as DataTableColumnHeader } from './DataTableColumnHeader.vue'
export { default as DataTablePagination } from './DataTablePagination.vue'
export { default as DataTableViewOptions } from './DataTableViewOptions.vue'
export { default as DataTableFacetedFilter } from './DataTableFacetedFilter.vue'
```

**Commit:**
```bash
git add frontend/src/components/ui/data-table/
git commit -m "feat(06-01): create DataTableViewOptions, FacetedFilter, and barrel export"
```
</task>

<task id="6" depends_on="2,3,4,5">
### Task 6: Verification

**Build + lint:**
```bash
cd frontend && npm run build && npm run lint
```

**Verify all files exist:**
```bash
ls -la frontend/src/components/ui/data-table/
```
Expected: DataTable.vue, DataTableColumnHeader.vue, DataTablePagination.vue, DataTableViewOptions.vue, DataTableFacetedFilter.vue, index.ts

**Type check:**
```bash
cd frontend && npx vue-tsc --noEmit 2>&1 | head -20
```
Expected: No errors in data-table components.
</task>
