---
phase: 01-foundation-setup
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - frontend/vitest.config.ts
  - frontend/src/test/setup.ts
  - frontend/src/components/ui/__tests__/Button.spec.ts
  - frontend/package.json
  - frontend/Makefile
  - .planning/phases/01-foundation-setup/01-icon-audit.md
autonomous: true

must_haves:
  truths:
    - "Vitest runs and at least one test passes (vitest run exits 0)"
    - "The smoke test mounts a real shadcn-vue Button component in jsdom"
    - "make ci-frontend includes vitest in its pipeline"
    - "Every one of the 198 unique MDI icons has a documented Lucide equivalent or gap resolution decision"
  artifacts:
    - path: "frontend/vitest.config.ts"
      provides: "Vitest configuration with jsdom, Vue plugin, and path aliases"
      contains: "defineConfig"
    - path: "frontend/src/test/setup.ts"
      provides: "Vitest global setup file"
      contains: "setup"
    - path: "frontend/src/components/ui/__tests__/Button.spec.ts"
      provides: "Smoke test proving Vitest + Vue + shadcn-vue pipeline works"
      contains: "Button"
    - path: ".planning/phases/01-foundation-setup/01-icon-audit.md"
      provides: "Complete MDI-to-Lucide icon mapping for all 198 unique icons"
      contains: "mdi-"
  key_links:
    - from: "frontend/vitest.config.ts"
      to: "@vitejs/plugin-vue"
      via: "plugin import"
      pattern: "vue\\(\\)"
    - from: "frontend/src/components/ui/__tests__/Button.spec.ts"
      to: "frontend/src/components/ui/button"
      via: "component import"
      pattern: "import.*Button.*from.*ui/button"
---

<objective>
Install and configure Vitest for component testing with a smoke test that mounts a real shadcn-vue Button, update the Makefile CI pipeline to include Vitest, and produce a complete MDI-to-Lucide icon mapping document for all 198 unique icons.

Purpose: Completes the Phase 1 foundation. Vitest proves the test infrastructure works end-to-end (mount Vue component in jsdom with Tailwind classes). The icon audit is a Phase 3 prerequisite — without it, the icon migration cannot be planned.

Output: Working Vitest with passing smoke test, updated Makefile, complete icon audit document.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-setup/01-CONTEXT.md
@frontend/package.json
@frontend/vite.config.ts
@frontend/vitest.config.ts (will be created)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Vitest, create config, write smoke test, update Makefile</name>
  <files>
    frontend/package.json
    frontend/vitest.config.ts
    frontend/src/test/setup.ts
    frontend/src/components/ui/__tests__/Button.spec.ts
    Makefile
  </files>
  <action>
    1. Install Vitest and testing dependencies:
       ```bash
       cd frontend
       npm install -D vitest@^4.0.0 @vue/test-utils@^2.4.0 jsdom
       ```
       IMPORTANT: Use jsdom (NOT happy-dom) — this was the explicit decision in CONTEXT.md. jsdom has more complete DOM implementation.

    2. Create `frontend/vitest.config.ts`:
       ```typescript
       import { defineConfig } from 'vitest/config'
       import vue from '@vitejs/plugin-vue'
       import { fileURLToPath, URL } from 'node:url'

       export default defineConfig({
         plugins: [vue()],
         test: {
           globals: true,
           environment: 'jsdom',
           setupFiles: ['./src/test/setup.ts'],
           include: ['src/**/*.{test,spec}.ts'],
           coverage: {
             provider: 'v8',
             reporter: ['text', 'html'],
             include: ['src/**/*.ts', 'src/**/*.vue'],
             exclude: ['src/components/ui/**', 'src/types/**'],
           }
         },
         resolve: {
           alias: {
             '@': fileURLToPath(new URL('./src', import.meta.url))
           }
         }
       })
       ```
       Note: This is a standalone config (NOT using mergeConfig with vite.config.ts). The CONTEXT.md mentions mergeConfig pattern, but a standalone config is simpler and avoids importing the tailwindcss Vite plugin into the test environment where it is not needed. The @/ alias is duplicated here intentionally. If there is a strong preference for mergeConfig, it can be refactored later, but standalone is more robust for the initial setup.

    3. Create `frontend/src/test/` directory and `frontend/src/test/setup.ts`:
       ```typescript
       // Vitest global setup
       // Add any global test configuration here

       // Suppress Vue warnings in tests unless debugging
       // import { config } from '@vue/test-utils'
       // config.global.stubs = {}
       ```
       Keep it minimal. This file exists for future setup needs (mocking global plugins, etc.).

    4. Create `frontend/src/components/ui/__tests__/Button.spec.ts`:
       ```typescript
       import { describe, it, expect } from 'vitest'
       import { mount } from '@vue/test-utils'
       import { Button } from '@/components/ui/button'

       describe('Button (smoke test)', () => {
         it('renders with default props', () => {
           const wrapper = mount(Button, {
             slots: {
               default: 'Click me'
             }
           })
           expect(wrapper.text()).toContain('Click me')
           expect(wrapper.element.tagName).toBe('BUTTON')
         })

         it('applies variant classes', () => {
           const wrapper = mount(Button, {
             props: {
               variant: 'destructive'
             },
             slots: {
               default: 'Delete'
             }
           })
           expect(wrapper.text()).toContain('Delete')
           // Button should render without errors regardless of variant
           expect(wrapper.element.tagName).toBe('BUTTON')
         })

         it('handles click events', async () => {
           const wrapper = mount(Button, {
             slots: {
               default: 'Submit'
             }
           })
           await wrapper.trigger('click')
           expect(wrapper.emitted('click')).toBeTruthy()
         })
       })
       ```

    5. Add `test` and `test:run` scripts to `frontend/package.json` scripts:
       ```json
       "test": "vitest",
       "test:run": "vitest run"
       ```

    6. Run the smoke test:
       ```bash
       cd frontend && npx vitest run
       ```
       All 3 tests must pass. If any fail, debug and fix before proceeding.

    7. Update the root `Makefile` to add Vitest to the ci-frontend target. The current ci-frontend has 3 steps (lint, format check, build). Add a Step 4 for Vitest:
       After the existing "Step 3/3: Building frontend..." section in the `ci-frontend` target, add:
       ```makefile
       	@echo ""
       	@echo "Step 4/4: Running frontend tests..."
       	@cd frontend && npx vitest run
       	@echo "Vitest passed"
       ```
       Also update the step numbering: Step 1/4, Step 2/4, Step 3/4, Step 4/4.

       Also add a standalone `test-frontend` target:
       ```makefile
       test-frontend:
       	@cd frontend && npx vitest run
       ```
       Add `test-frontend` to the .PHONY declaration at the top of the Makefile.

    8. Verify the full CI pipeline works:
       ```bash
       make ci-frontend
       ```
  </action>
  <verify>
    - `cd frontend && npx vitest run` exits 0 with 3 passing tests
    - `cat frontend/vitest.config.ts | grep "jsdom"` confirms jsdom environment
    - `cat frontend/package.json | grep "vitest"` confirms vitest in devDependencies
    - `cat frontend/package.json | grep "test:run"` confirms test script
    - `ls frontend/src/test/setup.ts` exists
    - `ls frontend/src/components/ui/__tests__/Button.spec.ts` exists
    - `grep "vitest" Makefile` confirms Makefile integration
    - `make ci-frontend` exits 0 (full CI pipeline including tests passes)
  </verify>
  <done>
    Vitest is installed and configured with jsdom. A smoke test mounts a real shadcn-vue Button component, verifies rendering, variant handling, and click events. All 3 tests pass. The Makefile ci-frontend target now includes Vitest as Step 4/4, and a standalone make test-frontend target exists.
  </done>
</task>

<task type="auto">
  <name>Task 2: Complete MDI-to-Lucide icon audit for all 198 unique icons</name>
  <files>
    .planning/phases/01-foundation-setup/01-icon-audit.md
  </files>
  <action>
    Produce a complete mapping of all 198 unique MDI icons used in the frontend to their Lucide equivalents.

    1. The full list of 198 unique MDI icons is (extracted from `grep -roh 'mdi-[a-z-]*' frontend/src/ | sort -u`):
       mdi-account, mdi-account-check, mdi-account-circle, mdi-account-details, mdi-account-group, mdi-account-off, mdi-account-plus, mdi-account-search, mdi-account-tie, mdi-alert, mdi-alert-circle, mdi-alert-circle-outline, mdi-api, mdi-arrow-left, mdi-arrow-left-bold-box, mdi-arrow-right, mdi-arrow-right-bold-box, mdi-atom, mdi-book-open, mdi-book-open-page-variant, mdi-book-open-variant, mdi-bookshelf, mdi-broom, mdi-cached, mdi-calendar, mdi-calendar-check, mdi-calendar-clock, mdi-cancel, mdi-certificate, mdi-chart-bar, mdi-chart-bell-curve, mdi-chart-box, mdi-chart-box-outline, mdi-chart-donut, mdi-chart-line, mdi-chart-scatter-plot, mdi-chart-scatter-plot-hexbin, mdi-check, mdi-check-all, mdi-check-bold, mdi-check-circle, mdi-check-circle-outline, mdi-check-decagram, mdi-checkbox-multiple-marked, mdi-chevron-down, mdi-chevron-left, mdi-chevron-right, mdi-chevron-up, mdi-circle, mdi-clock-alert, mdi-clock-check, mdi-clock-outline, mdi-clock-time-four, mdi-close, mdi-close-circle, mdi-close-octagon, mdi-cloud-outline, mdi-cloud-upload, mdi-code-json, mdi-code-tags, mdi-cog, mdi-cog-outline, mdi-compass, mdi-content-copy, mdi-counter, mdi-database, mdi-database-check, mdi-database-export, mdi-database-import, mdi-database-off-outline, mdi-database-outline, mdi-database-plus, mdi-database-refresh, mdi-database-search, mdi-database-sync, mdi-delete, mdi-delete-sweep, mdi-dna, mdi-domain, mdi-dots-vertical, mdi-download, mdi-email, mdi-export, mdi-eye, mdi-eye-off, mdi-family-tree, mdi-feature-search, mdi-file-delimited, mdi-file-document, mdi-file-document-multiple, mdi-file-document-outline, mdi-file-search, mdi-filter, mdi-filter-off, mdi-filter-outline, mdi-filter-remove, mdi-filter-variant, mdi-fire, mdi-fit-to-screen, mdi-folder-multiple, mdi-format-list-bulleted, mdi-gesture-swipe-horizontal, mdi-github, mdi-graph, mdi-graph-outline, mdi-harddisk, mdi-heart-pulse, mdi-help-circle, mdi-help-circle-outline, mdi-history, mdi-home, mdi-hospital, mdi-hospital-box, mdi-hospital-building, mdi-human, mdi-identifier, mdi-information, mdi-information-outline, mdi-lightbulb, mdi-lightning-bolt, mdi-link, mdi-lock, mdi-lock-check, mdi-lock-plus, mdi-lock-reset, mdi-login, mdi-logout, mdi-magnify, mdi-magnify-minus-outline, mdi-magnify-plus-outline, mdi-magnify-remove-outline, mdi-map-marker, mdi-map-marker-distance, mdi-medical-bag, mdi-memory, mdi-merge, mdi-microscope, mdi-minus-circle, mdi-molecule, mdi-new-box, mdi-numeric, mdi-open-in-new, mdi-package-variant, mdi-palette, mdi-pause, mdi-pencil, mdi-pipe, mdi-pipeline, mdi-play, mdi-play-circle, mdi-play-pause, mdi-plus, mdi-progress-clock, mdi-protein, mdi-publish, mdi-refresh, mdi-refresh-auto, mdi-restart-alert, mdi-robot, mdi-rocket-launch, mdi-ruler, mdi-select-all, mdi-server, mdi-shape, mdi-share-variant, mdi-shield-account, mdi-shield-check, mdi-shield-crown, mdi-shield-lock, mdi-sort, mdi-sort-numeric-descending, mdi-speedometer, mdi-star, mdi-star-outline, mdi-stop, mdi-swap-horizontal, mdi-tag-multiple, mdi-target, mdi-test-tube, mdi-text-box-remove-outline, mdi-text-box-search-outline, mdi-text-search, mdi-transit-connection-variant, mdi-trending-down, mdi-trending-up, mdi-update, mdi-upload, mdi-view-dashboard, mdi-view-dashboard-variant, mdi-view-list, mdi-virus, mdi-virus-outline, mdi-vuejs, mdi-weather-night, mdi-weather-sunny, mdi-web, mdi-wifi, mdi-wifi-off

    2. For each icon, determine the Lucide equivalent. Use the Lucide icon set (https://lucide.dev/icons) as reference. The lucide-vue-next package is already installed.

    3. Categorize each mapping as one of:
       - **direct**: Lucide has an equivalent icon with matching semantics (e.g., mdi-home -> Home)
       - **close**: Lucide has a similar icon with slightly different name/style (e.g., mdi-chart-scatter-plot -> ScatterChart)
       - **generic**: No close match; use a generic Lucide icon that works in context (e.g., mdi-dna -> Dna if available, or Atom)
       - **drop**: Decorative-only icon with no reasonable replacement; will be removed during migration

    4. Create the audit document at `.planning/phases/01-foundation-setup/01-icon-audit.md` with this structure:
       ```markdown
       # MDI to Lucide Icon Audit

       **Total unique MDI icons:** 198
       **Direct matches:** [count]
       **Close matches:** [count]
       **Generic replacements:** [count]
       **Dropped (decorative only):** [count]

       ## Mapping Table

       | MDI Icon | Lucide Component | Status | Notes |
       |----------|-----------------|--------|-------|
       | mdi-account | User | direct | |
       | mdi-dna | Dna | direct | |
       ...

       ## Gap Icons (require special attention in Phase 3)

       [List any icons where the Lucide replacement significantly differs from the MDI original, along with the context where they're used]
       ```

    5. Use the Lucide icon reference to verify each mapping. Check https://lucide.dev/icons for icon availability. The lucide-vue-next package exports icons as PascalCase Vue components (e.g., `<Home />`, `<User />`, `<ChevronDown />`).

    6. Pay special attention to domain-specific icons that may not have direct matches:
       - mdi-dna, mdi-protein, mdi-molecule, mdi-atom (science)
       - mdi-hospital, mdi-hospital-box, mdi-hospital-building, mdi-medical-bag (medical)
       - mdi-virus, mdi-virus-outline (pathology)
       - mdi-pipeline, mdi-pipe (data processing)
       - mdi-vuejs (framework logo — drop)

       Per CONTEXT.md decision: use closest available Lucide icon for all of these. No custom SVGs. Context comes from labels, not icons.
  </action>
  <verify>
    - `wc -l .planning/phases/01-foundation-setup/01-icon-audit.md` shows substantial file (200+ lines for 198 icons)
    - `grep -c "mdi-" .planning/phases/01-foundation-setup/01-icon-audit.md` matches or exceeds 198 (all icons documented)
    - `grep -c "direct\|close\|generic\|drop" .planning/phases/01-foundation-setup/01-icon-audit.md` matches or exceeds 198 (all icons categorized)
    - Every icon from the list above appears in the audit document
  </verify>
  <done>
    A complete MDI-to-Lucide icon mapping exists for all 198 unique icons. Each icon has a Lucide equivalent (or is marked as drop). The document includes counts by category and a section highlighting gap icons that need special attention during Phase 3 migration.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npx vitest run` exits 0 with 3+ passing tests
2. `make ci-frontend` exits 0 (full CI pipeline including Vitest)
3. `cat .planning/phases/01-foundation-setup/01-icon-audit.md | head -10` shows audit header with counts
4. `grep -c "mdi-" .planning/phases/01-foundation-setup/01-icon-audit.md` >= 198
5. `ls frontend/vitest.config.ts frontend/src/test/setup.ts frontend/src/components/ui/__tests__/Button.spec.ts` all exist

Overall Phase 1 verification (run after all 3 plans complete):
6. `cd frontend && npm run build` exits 0
7. `cd frontend && npm run dev` starts without errors
8. `ls frontend/tsconfig.json frontend/components.json frontend/vitest.config.ts` all exist
9. `ls frontend/src/types/gene.ts frontend/src/lib/utils.ts frontend/src/components/ui/button/Button.vue` all exist
</verification>

<success_criteria>
- FNDN-09: Vitest installed and configured for component testing with jsdom
- FNDN-10: Complete MDI icon audit documenting all 198 unique icons with Lucide equivalents or gap-resolution decisions
- TEST-01: Vitest configured with Vue Test Utils and jsdom, smoke test passes
- make ci-frontend includes Vitest as part of the pipeline
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup/01-03-SUMMARY.md`
</output>
