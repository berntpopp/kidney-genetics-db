---
phase: "08"
plan: "08-01"
title: "D3 chart wrappers and theme composable"
wave: 1
depends_on: ["04-02"]
files_modified:
  - "frontend/src/components/visualizations/D3BarChart.vue"
  - "frontend/src/components/visualizations/D3DonutChart.vue"
  - "frontend/src/components/visualizations/EvidenceCompositionChart.vue"
  - "frontend/src/components/visualizations/SourceDistributionsChart.vue"
  - "frontend/src/components/visualizations/UpSetChart.vue"
autonomous: true
estimated_minutes: 50
requirements:
  - "VIZ-01: D3 charts detect dark mode without useTheme from Vuetify"
  - "VIZ-02: Chart wrapper components use Card + Badge + Button"
  - "VIZ-03: All D3 rendering logic preserved unchanged"

must_haves:
  truths:
    - "All 5 files have zero `from 'vuetify'` imports"
    - "All 5 files have zero Vuetify component tags"
    - "`npm run build` succeeds"
    - "`npm run lint` has 0 errors"
    - "D3 charts render correctly in both light and dark mode"
  artifacts:
    - path: "frontend/src/components/visualizations/D3BarChart.vue"
      provides: "Bar chart with dark mode via useAppTheme"
    - path: "frontend/src/components/visualizations/D3DonutChart.vue"
      provides: "Donut chart with dark mode via useAppTheme"

---

# 08-01: D3 Chart Wrappers and Theme

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Replace `useTheme()` from Vuetify with `useAppTheme()` in D3 chart components, and replace Vuetify wrapper components with shadcn-vue equivalents.

**Architecture:** D3 rendering logic stays 100% unchanged. Only the theme detection and wrapper UI components change.

---

## Theme Replacement Pattern

All D3 charts using `useTheme()` from Vuetify follow this replacement:

```typescript
// BEFORE
import { useTheme } from 'vuetify'
const theme = useTheme()
const isDark = computed(() => theme.global.current.value.dark)

// AFTER
import { useAppTheme } from '@/composables/useAppTheme'
const { isDark } = useAppTheme()
```

For color access, replace Vuetify theme colors with CSS variables:
```typescript
// BEFORE
const primaryColor = theme.global.current.value.colors.primary
const textColor = theme.global.current.value.dark ? '#fff' : '#000'

// AFTER
const primaryColor = getComputedStyle(document.documentElement).getPropertyValue('--primary').trim()
// Or use fixed values:
const textColor = computed(() => isDark.value ? '#e5e7eb' : '#1f2937')
```

---

<task id="1">
### Task 1: Migrate D3BarChart.vue + D3DonutChart.vue

**Files:**
- `frontend/src/components/visualizations/D3BarChart.vue`
- `frontend/src/components/visualizations/D3DonutChart.vue`

For each file:
1. Replace `import { useTheme } from 'vuetify'` → `import { useAppTheme } from '@/composables/useAppTheme'`
2. Replace `const theme = useTheme()` → `const { isDark } = useAppTheme()`
3. Replace all `theme.global.current.value.dark` → `isDark.value`
4. Replace Vuetify color access with CSS variable reads or computed values
5. Keep ALL D3 code unchanged (scales, axes, animations, tooltips)

**Commit:**
```bash
git add frontend/src/components/visualizations/D3BarChart.vue frontend/src/components/visualizations/D3DonutChart.vue
git commit -m "feat(08-01): replace Vuetify useTheme with useAppTheme in D3 charts"
```
</task>

<task id="2">
### Task 2: Migrate EvidenceCompositionChart + SourceDistributionsChart + UpSetChart

**Files:**
- `frontend/src/components/visualizations/EvidenceCompositionChart.vue`
- `frontend/src/components/visualizations/SourceDistributionsChart.vue`
- `frontend/src/components/visualizations/UpSetChart.vue`

These are wrapper components that embed D3 sub-components. Replace Vuetify UI:
- `v-card` → Card
- `v-checkbox` → Checkbox or custom toggle
- `v-btn-toggle` / `v-btn` → Button group with Tailwind
- `v-select` → Select
- `v-progress-circular` → Tailwind spinner
- `v-alert` → Alert
- `v-tooltip` → Tooltip
- `v-chip`/`v-chip-group` → Badge / flex wrap
- `v-overlay` → simple overlay div with `absolute inset-0`
- `v-menu`/`v-list` → DropdownMenu
- `v-row`/`v-col` → Tailwind grid
- All Vuetify utility classes → Tailwind

**Button toggle group pattern:**
```vue
<!-- v-btn-toggle replacement -->
<div class="inline-flex rounded-md border">
  <Button
    v-for="option in viewOptions"
    :key="option.value"
    :variant="activeView === option.value ? 'default' : 'ghost'"
    size="sm"
    class="rounded-none first:rounded-l-md last:rounded-r-md"
    @click="activeView = option.value"
  >
    {{ option.label }}
  </Button>
</div>
```

**Commit:**
```bash
git add frontend/src/components/visualizations/EvidenceCompositionChart.vue \
  frontend/src/components/visualizations/SourceDistributionsChart.vue \
  frontend/src/components/visualizations/UpSetChart.vue
git commit -m "feat(08-01): migrate chart wrappers to Card + Button + Select"
```
</task>

<task id="3" depends_on="1,2">
### Task 3: Verification

```bash
cd frontend && npm run build && npm run lint
```

```bash
grep -E "from 'vuetify'" frontend/src/components/visualizations/*.vue
grep -rE "v-card|v-btn-toggle|v-btn|v-checkbox|v-select|v-chip|v-alert|v-progress-circular|v-tooltip|v-overlay|v-menu|v-row|v-col" \
  frontend/src/components/visualizations/ --include="*.vue"
```
Expected: 0 matches for both.

**Visual:** Dashboard charts render in light and dark mode. Toggle between views works.
</task>
